<!doctype html><html lang=en-us><head><link rel=preload href=/lib/font-awesome/webfonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous><script type=text/javascript src=https://latest.cactus.chat/cactus.js></script>
<link rel=stylesheet href=https://latest.cactus.chat/style.css type=text/css><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>ç»†è°ˆçº¿ç¨‹æ± è®¾è®¡ä¸ç›‘æ§ | pinkhello</title><link rel=canonical href=https://pinkhello.cc/posts/47-%E7%BB%86%E8%B0%88%E7%BA%BF%E7%A8%8B%E6%B1%A0%E8%AE%BE%E8%AE%A1%E4%B8%8E%E7%9B%91%E6%8E%A7/><meta name=description content="ğŸ‘·Hey! æˆ‘æ˜¯ **pinkhello**ï¼ŒğŸ’» ä¸€ååç«¯ç¨‹åºå‘˜ã€‚**é‡è¦æç¤º**: åœ¨æ‚¨é˜…è¯»æ–‡ç« å¹¶è¯„è®ºä¹‹å‰ï¼Œè¯·å…ˆè®¤çœŸé˜…è¯»[**è¯„è®ºæ‰¿è¯º**](http://pinkhello.cc/promise)ã€‚"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta property="og:title" content="ç»†è°ˆçº¿ç¨‹æ± è®¾è®¡ä¸ç›‘æ§"><meta property="og:description" content="å‰è¨€ ä¸‡å¹´å…«è‚¡æ–‡ï¼Œåœ¨å·¥ä½œä¸­è‚¯å®šå¤šå¤šå°‘å°‘éƒ½ä½¿ç”¨äº†çº¿ç¨‹æ± ï¼Œä½†æœ‰æ²¡æœ‰çœŸæ­£çš„å»äº†è§£çº¿ç¨‹æ± çš„æ•´ä¸ªè¿è¡Œæœºåˆ¶å’Œæ ¸å¿ƒå…³é”®ç‚¹ã€‚ä»Šå¤©åˆ†äº«ä¸€ä¸‹ã€‚
çº¿ç¨‹æ± ç®€ä»‹ å…ˆè¯´ çº¿ç¨‹(Thread) , åœ¨ Wiki çš„è§£é‡Šæ˜¯æ“ä½œç³»ç»Ÿèƒ½è¿›è¡Œè¿ç®—è°ƒåº¦çš„æœ€å°å•å…ƒã€‚åŒ…å«åœ¨è¿›ç¨‹ä¸­ï¼Œæ˜¯è¿›ç¨‹å®é™…è¿ä½œçš„å•å…ƒã€‚ OKï¼Œå…ˆè®°ä½è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬è¯´ çº¿ç¨‹æ± (Thread Pool) ï¼Œé¡¾åæ€ä¹‰ï¼ŒåŸºäºæ± åŒ–æ€æƒ³çš„ç®¡ç†çº¿ç¨‹çš„æ‰‹æ®µï¼ˆå·¥å…·ï¼‰ã€‚æ—¢ç„¶å«çº¿ç¨‹æ± äº†ï¼Œå¯ä»¥ çŸ¥é“è‚¯å®šæ˜¯å¤šçº¿ç¨‹çš„æœåŠ¡ç¯å¢ƒä¸‹ã€‚
æˆ‘ä»¬éƒ½çŸ¥é“Serverçš„èµ„æºæ˜¯æœ‰é™çš„ï¼Œä¸å¯èƒ½æ— æ­¢å¢ƒçš„æ‰©å¼ ï¼ˆä»æˆæœ¬ã€è¿ç»´ä¸Šè€ƒè™‘ï¼‰ã€‚çº¿ç¨‹è¿‡åˆ†çš„å¼€è¾Ÿçš„è¯ï¼Œä¼šå¯¼è‡´æ•´ä½“æœåŠ¡å™¨èµ„æºåƒç´§ï¼ˆçº¿ç¨‹å¸¦æ¥çš„å¼€é”€ã€åˆ›å»ºã€è°ƒåº¦ç­‰ç­‰ï¼‰ã€‚ æ± åŒ–çš„æ€æƒ³ï¼Œçº¿ç¨‹æ± ç»´æŠ¤ç€å¤šä¸ªçº¿ç¨‹ï¼Œç­‰å¾…è°ƒåº¦åˆ†é…å¹¶å‘ä»»åŠ¡å»æ‰§è¡Œã€‚ä¸€æ–¹é¢é¿å…æœ‰ä»»åŠ¡å°±åˆ›å»ºçº¿ç¨‹å¸¦æ¥çš„é¢å¤–çš„å¼€é”€ï¼Œå¦ä¸€æ–¹é¢ä¹Ÿæ˜¯ä¿æŠ¤æœåŠ¡å™¨äº§ç”Ÿè¿‡å¤šçš„çº¿ç¨‹æ•°é‡ã€‚
çº¿ç¨‹æ± è§£å†³ä»€ä¹ˆé—®é¢˜ çº¿ç¨‹æ± è§£å†³çš„æ ¸å¿ƒé—®é¢˜æ˜¯èµ„æºç®¡ç†é—®é¢˜ï¼Œåœ¨å¹¶å‘ç¯å¢ƒä¸‹ï¼Œç³»ç»Ÿå’ŒæœåŠ¡å¹¶ä¸çŸ¥é“åœ¨ä»€ä¹ˆæ—¶å€™éœ€è¦å¤šå°‘èµ„æºã€‚è€Œ æ± åŒ–(Pooling) æ€æƒ³ï¼Œå°±æ˜¯ä¸ºäº†å°†èµ„æºç»Ÿä¸€ç®¡ç†çš„æƒ…å†µä¸‹ï¼Œå‡å°é£é™©çš„æ€æƒ³ã€‚
Wikiä¸Š ThreadPoolå›¾
P.S : æ± åŒ–æ€æƒ³ä¸¾ä¾‹
å†…å­˜æ± (Memory Pool) å¯¹è±¡æ± (Object Pool) å³å®ä¾‹æ±  è¿æ¥æ± (Connection Pool) çº¿ç¨‹æ± æ ¸å¿ƒè®¾è®¡ åœ¨çœ‹çº¿ç¨‹æ± çš„è®¾è®¡ä¹‹å‰ï¼Œå…ˆäº†è§£ä¸€ä¸‹çº¿ç¨‹æ± çš„æ„é€ å‚æ•°
corePoolSize â€“ the number of threads to keep in the pool, even if they are idle, unless allowCoreThreadTimeOut is set maximumPoolSize â€“ the maximum number of threads to allow in the pool keepAliveTime â€“ when the number of threads is greater than the core, this is the maximum time that excess idle threads will wait for new tasks before terminating."><meta property="og:type" content="article"><meta property="og:url" content="https://pinkhello.cc/posts/47-%E7%BB%86%E8%B0%88%E7%BA%BF%E7%A8%8B%E6%B1%A0%E8%AE%BE%E8%AE%A1%E4%B8%8E%E7%9B%91%E6%8E%A7/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-03-05T22:05:23+08:00"><meta property="article:modified_time" content="2022-03-05T22:05:23+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="ç»†è°ˆçº¿ç¨‹æ± è®¾è®¡ä¸ç›‘æ§"><meta name=twitter:description content="å‰è¨€ ä¸‡å¹´å…«è‚¡æ–‡ï¼Œåœ¨å·¥ä½œä¸­è‚¯å®šå¤šå¤šå°‘å°‘éƒ½ä½¿ç”¨äº†çº¿ç¨‹æ± ï¼Œä½†æœ‰æ²¡æœ‰çœŸæ­£çš„å»äº†è§£çº¿ç¨‹æ± çš„æ•´ä¸ªè¿è¡Œæœºåˆ¶å’Œæ ¸å¿ƒå…³é”®ç‚¹ã€‚ä»Šå¤©åˆ†äº«ä¸€ä¸‹ã€‚
çº¿ç¨‹æ± ç®€ä»‹ å…ˆè¯´ çº¿ç¨‹(Thread) , åœ¨ Wiki çš„è§£é‡Šæ˜¯æ“ä½œç³»ç»Ÿèƒ½è¿›è¡Œè¿ç®—è°ƒåº¦çš„æœ€å°å•å…ƒã€‚åŒ…å«åœ¨è¿›ç¨‹ä¸­ï¼Œæ˜¯è¿›ç¨‹å®é™…è¿ä½œçš„å•å…ƒã€‚ OKï¼Œå…ˆè®°ä½è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬è¯´ çº¿ç¨‹æ± (Thread Pool) ï¼Œé¡¾åæ€ä¹‰ï¼ŒåŸºäºæ± åŒ–æ€æƒ³çš„ç®¡ç†çº¿ç¨‹çš„æ‰‹æ®µï¼ˆå·¥å…·ï¼‰ã€‚æ—¢ç„¶å«çº¿ç¨‹æ± äº†ï¼Œå¯ä»¥ çŸ¥é“è‚¯å®šæ˜¯å¤šçº¿ç¨‹çš„æœåŠ¡ç¯å¢ƒä¸‹ã€‚
æˆ‘ä»¬éƒ½çŸ¥é“Serverçš„èµ„æºæ˜¯æœ‰é™çš„ï¼Œä¸å¯èƒ½æ— æ­¢å¢ƒçš„æ‰©å¼ ï¼ˆä»æˆæœ¬ã€è¿ç»´ä¸Šè€ƒè™‘ï¼‰ã€‚çº¿ç¨‹è¿‡åˆ†çš„å¼€è¾Ÿçš„è¯ï¼Œä¼šå¯¼è‡´æ•´ä½“æœåŠ¡å™¨èµ„æºåƒç´§ï¼ˆçº¿ç¨‹å¸¦æ¥çš„å¼€é”€ã€åˆ›å»ºã€è°ƒåº¦ç­‰ç­‰ï¼‰ã€‚ æ± åŒ–çš„æ€æƒ³ï¼Œçº¿ç¨‹æ± ç»´æŠ¤ç€å¤šä¸ªçº¿ç¨‹ï¼Œç­‰å¾…è°ƒåº¦åˆ†é…å¹¶å‘ä»»åŠ¡å»æ‰§è¡Œã€‚ä¸€æ–¹é¢é¿å…æœ‰ä»»åŠ¡å°±åˆ›å»ºçº¿ç¨‹å¸¦æ¥çš„é¢å¤–çš„å¼€é”€ï¼Œå¦ä¸€æ–¹é¢ä¹Ÿæ˜¯ä¿æŠ¤æœåŠ¡å™¨äº§ç”Ÿè¿‡å¤šçš„çº¿ç¨‹æ•°é‡ã€‚
çº¿ç¨‹æ± è§£å†³ä»€ä¹ˆé—®é¢˜ çº¿ç¨‹æ± è§£å†³çš„æ ¸å¿ƒé—®é¢˜æ˜¯èµ„æºç®¡ç†é—®é¢˜ï¼Œåœ¨å¹¶å‘ç¯å¢ƒä¸‹ï¼Œç³»ç»Ÿå’ŒæœåŠ¡å¹¶ä¸çŸ¥é“åœ¨ä»€ä¹ˆæ—¶å€™éœ€è¦å¤šå°‘èµ„æºã€‚è€Œ æ± åŒ–(Pooling) æ€æƒ³ï¼Œå°±æ˜¯ä¸ºäº†å°†èµ„æºç»Ÿä¸€ç®¡ç†çš„æƒ…å†µä¸‹ï¼Œå‡å°é£é™©çš„æ€æƒ³ã€‚
Wikiä¸Š ThreadPoolå›¾
P.S : æ± åŒ–æ€æƒ³ä¸¾ä¾‹
å†…å­˜æ± (Memory Pool) å¯¹è±¡æ± (Object Pool) å³å®ä¾‹æ±  è¿æ¥æ± (Connection Pool) çº¿ç¨‹æ± æ ¸å¿ƒè®¾è®¡ åœ¨çœ‹çº¿ç¨‹æ± çš„è®¾è®¡ä¹‹å‰ï¼Œå…ˆäº†è§£ä¸€ä¸‹çº¿ç¨‹æ± çš„æ„é€ å‚æ•°
corePoolSize â€“ the number of threads to keep in the pool, even if they are idle, unless allowCoreThreadTimeOut is set maximumPoolSize â€“ the maximum number of threads to allow in the pool keepAliveTime â€“ when the number of threads is greater than the core, this is the maximum time that excess idle threads will wait for new tasks before terminating."><link rel=stylesheet href=https://pinkhello.cc/css/styles.94f653e9e151e28067a7c5dbbc4600cbd5a3c721e79faaf971e523c40f3b249b8e4f20bb57810dfffa8d559ca5c140fd56eb4cd9c0853113ad08e66afdb08bdd.css integrity="sha512-lPZT6eFR4oBnp8XbvEYAy9WjxyHnn6r5ceUjxA87JJuOTyC7V4EN//qNVZylwUD9VutM2cCFMROtCOZq/bCL3Q=="><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script>
<script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=icon type=image/png href=https://pinkhello.cc/images/favicon.ico><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-M2FXWC325L","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body class="max-width mx-auto px3 ltr"><div class="content index py4"><div id=header-post><a id=menu-icon href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=menu-icon-tablet href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=top-icon-tablet href=# onclick='$("html, body").animate({scrollTop:0},"fast")' style=display:none aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
<span id=menu><span id=nav><ul><li><a href=/>Home</a></li><li><a href=/posts>Posts</a></li><li><a href=/categories>Category</a></li><li><a href=/tags>Tag</a></li><li><a href=/index.xml>Rss</a></li><li><a href=/jobs>Job</a></li></ul></span><br><span id=actions><ul><li><a class=icon href=https://pinkhello.cc/posts/46-lrucache-%E5%AE%9E%E7%8E%B0/ aria-label=Previous><i class="fas fa-chevron-left" aria-hidden=true onmouseover='$("#i-prev").toggle()' onmouseout='$("#i-prev").toggle()'></i></a></li><li><a class=icon href=https://pinkhello.cc/posts/golang-for-range-%E6%8E%A2%E7%A9%B6/ aria-label=Next><i class="fas fa-chevron-right" aria-hidden=true onmouseover='$("#i-next").toggle()' onmouseout='$("#i-next").toggle()'></i></a></li><li><a class=icon href=# onclick='$("html, body").animate({scrollTop:0},"fast")' aria-label="Top of Page"><i class="fas fa-chevron-up" aria-hidden=true onmouseover='$("#i-top").toggle()' onmouseout='$("#i-top").toggle()'></i></a></li><li><a class=icon href=# aria-label=Share><i class="fas fa-share-alt" aria-hidden=true onmouseover='$("#i-share").toggle()' onmouseout='$("#i-share").toggle()' onclick='return $("#share").toggle(),!1'></i></a></li></ul><span id=i-prev class=info style=display:none>Previous post</span>
<span id=i-next class=info style=display:none>Next post</span>
<span id=i-top class=info style=display:none>Back to top</span>
<span id=i-share class=info style=display:none>Share post</span></span><br><div id=share style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fpinkhello.cc%2fposts%2f47-%25E7%25BB%2586%25E8%25B0%2588%25E7%25BA%25BF%25E7%25A8%258B%25E6%25B1%25A0%25E8%25AE%25BE%25E8%25AE%25A1%25E4%25B8%258E%25E7%259B%2591%25E6%258E%25A7%2f" aria-label=Facebook><i class="fab fa-facebook" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2fpinkhello.cc%2fposts%2f47-%25E7%25BB%2586%25E8%25B0%2588%25E7%25BA%25BF%25E7%25A8%258B%25E6%25B1%25A0%25E8%25AE%25BE%25E8%25AE%25A1%25E4%25B8%258E%25E7%259B%2591%25E6%258E%25A7%2f&text=%e7%bb%86%e8%b0%88%e7%ba%bf%e7%a8%8b%e6%b1%a0%e8%ae%be%e8%ae%a1%e4%b8%8e%e7%9b%91%e6%8e%a7" aria-label=Twitter><i class="fab fa-twitter" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fpinkhello.cc%2fposts%2f47-%25E7%25BB%2586%25E8%25B0%2588%25E7%25BA%25BF%25E7%25A8%258B%25E6%25B1%25A0%25E8%25AE%25BE%25E8%25AE%25A1%25E4%25B8%258E%25E7%259B%2591%25E6%258E%25A7%2f&title=%e7%bb%86%e8%b0%88%e7%ba%bf%e7%a8%8b%e6%b1%a0%e8%ae%be%e8%ae%a1%e4%b8%8e%e7%9b%91%e6%8e%a7" aria-label=Linkedin><i class="fab fa-linkedin" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fpinkhello.cc%2fposts%2f47-%25E7%25BB%2586%25E8%25B0%2588%25E7%25BA%25BF%25E7%25A8%258B%25E6%25B1%25A0%25E8%25AE%25BE%25E8%25AE%25A1%25E4%25B8%258E%25E7%259B%2591%25E6%258E%25A7%2f&is_video=false&description=%e7%bb%86%e8%b0%88%e7%ba%bf%e7%a8%8b%e6%b1%a0%e8%ae%be%e8%ae%a1%e4%b8%8e%e7%9b%91%e6%8e%a7" aria-label=Pinterest><i class="fab fa-pinterest" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=%e7%bb%86%e8%b0%88%e7%ba%bf%e7%a8%8b%e6%b1%a0%e8%ae%be%e8%ae%a1%e4%b8%8e%e7%9b%91%e6%8e%a7&body=Check out this article: https%3a%2f%2fpinkhello.cc%2fposts%2f47-%25E7%25BB%2586%25E8%25B0%2588%25E7%25BA%25BF%25E7%25A8%258B%25E6%25B1%25A0%25E8%25AE%25BE%25E8%25AE%25A1%25E4%25B8%258E%25E7%259B%2591%25E6%258E%25A7%2f" aria-label=Email><i class="fas fa-envelope" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fpinkhello.cc%2fposts%2f47-%25E7%25BB%2586%25E8%25B0%2588%25E7%25BA%25BF%25E7%25A8%258B%25E6%25B1%25A0%25E8%25AE%25BE%25E8%25AE%25A1%25E4%25B8%258E%25E7%259B%2591%25E6%258E%25A7%2f&title=%e7%bb%86%e8%b0%88%e7%ba%bf%e7%a8%8b%e6%b1%a0%e8%ae%be%e8%ae%a1%e4%b8%8e%e7%9b%91%e6%8e%a7" aria-label=Pocket><i class="fab fa-get-pocket" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fpinkhello.cc%2fposts%2f47-%25E7%25BB%2586%25E8%25B0%2588%25E7%25BA%25BF%25E7%25A8%258B%25E6%25B1%25A0%25E8%25AE%25BE%25E8%25AE%25A1%25E4%25B8%258E%25E7%259B%2591%25E6%258E%25A7%2f&title=%e7%bb%86%e8%b0%88%e7%ba%bf%e7%a8%8b%e6%b1%a0%e8%ae%be%e8%ae%a1%e4%b8%8e%e7%9b%91%e6%8e%a7" aria-label=reddit><i class="fab fa-reddit" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fpinkhello.cc%2fposts%2f47-%25E7%25BB%2586%25E8%25B0%2588%25E7%25BA%25BF%25E7%25A8%258B%25E6%25B1%25A0%25E8%25AE%25BE%25E8%25AE%25A1%25E4%25B8%258E%25E7%259B%2591%25E6%258E%25A7%2f&name=%e7%bb%86%e8%b0%88%e7%ba%bf%e7%a8%8b%e6%b1%a0%e8%ae%be%e8%ae%a1%e4%b8%8e%e7%9b%91%e6%8e%a7&description=%e5%89%8d%e8%a8%80%20%e4%b8%87%e5%b9%b4%e5%85%ab%e8%82%a1%e6%96%87%ef%bc%8c%e5%9c%a8%e5%b7%a5%e4%bd%9c%e4%b8%ad%e8%82%af%e5%ae%9a%e5%a4%9a%e5%a4%9a%e5%b0%91%e5%b0%91%e9%83%bd%e4%bd%bf%e7%94%a8%e4%ba%86%e7%ba%bf%e7%a8%8b%e6%b1%a0%ef%bc%8c%e4%bd%86%e6%9c%89%e6%b2%a1%e6%9c%89%e7%9c%9f%e6%ad%a3%e7%9a%84%e5%8e%bb%e4%ba%86%e8%a7%a3%e7%ba%bf%e7%a8%8b%e6%b1%a0%e7%9a%84%e6%95%b4%e4%b8%aa%e8%bf%90%e8%a1%8c%e6%9c%ba%e5%88%b6%e5%92%8c%e6%a0%b8%e5%bf%83%e5%85%b3%e9%94%ae%e7%82%b9%e3%80%82%e4%bb%8a%e5%a4%a9%e5%88%86%e4%ba%ab%e4%b8%80%e4%b8%8b%e3%80%82%0a%e7%ba%bf%e7%a8%8b%e6%b1%a0%e7%ae%80%e4%bb%8b%20%e5%85%88%e8%af%b4%20%e7%ba%bf%e7%a8%8b%28Thread%29%20%2c%20%e5%9c%a8%20Wiki%20%e7%9a%84%e8%a7%a3%e9%87%8a%e6%98%af%e6%93%8d%e4%bd%9c%e7%b3%bb%e7%bb%9f%e8%83%bd%e8%bf%9b%e8%a1%8c%e8%bf%90%e7%ae%97%e8%b0%83%e5%ba%a6%e7%9a%84%e6%9c%80%e5%b0%8f%e5%8d%95%e5%85%83%e3%80%82%e5%8c%85%e5%90%ab%e5%9c%a8%e8%bf%9b%e7%a8%8b%e4%b8%ad%ef%bc%8c%e6%98%af%e8%bf%9b%e7%a8%8b%e5%ae%9e%e9%99%85%e8%bf%90%e4%bd%9c%e7%9a%84%e5%8d%95%e5%85%83%e3%80%82%20OK%ef%bc%8c%e5%85%88%e8%ae%b0%e4%bd%8f%e8%bf%99%e4%b8%80%e7%82%b9%ef%bc%8c%e6%88%91%e4%bb%ac%e8%af%b4%20%e7%ba%bf%e7%a8%8b%e6%b1%a0%28Thread%20Pool%29%20%ef%bc%8c%e9%a1%be%e5%90%8d%e6%80%9d%e4%b9%89%ef%bc%8c%e5%9f%ba%e4%ba%8e%e6%b1%a0%e5%8c%96%e6%80%9d%e6%83%b3%e7%9a%84%e7%ae%a1%e7%90%86%e7%ba%bf%e7%a8%8b%e7%9a%84%e6%89%8b%e6%ae%b5%ef%bc%88%e5%b7%a5%e5%85%b7%ef%bc%89%e3%80%82%e6%97%a2%e7%84%b6%e5%8f%ab%e7%ba%bf%e7%a8%8b%e6%b1%a0%e4%ba%86%ef%bc%8c%e5%8f%af%e4%bb%a5%20%e7%9f%a5%e9%81%93%e8%82%af%e5%ae%9a%e6%98%af%e5%a4%9a%e7%ba%bf%e7%a8%8b%e7%9a%84%e6%9c%8d%e5%8a%a1%e7%8e%af%e5%a2%83%e4%b8%8b%e3%80%82%0a%e6%88%91%e4%bb%ac%e9%83%bd%e7%9f%a5%e9%81%93Server%e7%9a%84%e8%b5%84%e6%ba%90%e6%98%af%e6%9c%89%e9%99%90%e7%9a%84%ef%bc%8c%e4%b8%8d%e5%8f%af%e8%83%bd%e6%97%a0%e6%ad%a2%e5%a2%83%e7%9a%84%e6%89%a9%e5%bc%a0%ef%bc%88%e4%bb%8e%e6%88%90%e6%9c%ac%e3%80%81%e8%bf%90%e7%bb%b4%e4%b8%8a%e8%80%83%e8%99%91%ef%bc%89%e3%80%82%e7%ba%bf%e7%a8%8b%e8%bf%87%e5%88%86%e7%9a%84%e5%bc%80%e8%be%9f%e7%9a%84%e8%af%9d%ef%bc%8c%e4%bc%9a%e5%af%bc%e8%87%b4%e6%95%b4%e4%bd%93%e6%9c%8d%e5%8a%a1%e5%99%a8%e8%b5%84%e6%ba%90%e5%90%83%e7%b4%a7%ef%bc%88%e7%ba%bf%e7%a8%8b%e5%b8%a6%e6%9d%a5%e7%9a%84%e5%bc%80%e9%94%80%e3%80%81%e5%88%9b%e5%bb%ba%e3%80%81%e8%b0%83%e5%ba%a6%e7%ad%89%e7%ad%89%ef%bc%89%e3%80%82%20%e6%b1%a0%e5%8c%96%e7%9a%84%e6%80%9d%e6%83%b3%ef%bc%8c%e7%ba%bf%e7%a8%8b%e6%b1%a0%e7%bb%b4%e6%8a%a4%e7%9d%80%e5%a4%9a%e4%b8%aa%e7%ba%bf%e7%a8%8b%ef%bc%8c%e7%ad%89%e5%be%85%e8%b0%83%e5%ba%a6%e5%88%86%e9%85%8d%e5%b9%b6%e5%8f%91%e4%bb%bb%e5%8a%a1%e5%8e%bb%e6%89%a7%e8%a1%8c%e3%80%82%e4%b8%80%e6%96%b9%e9%9d%a2%e9%81%bf%e5%85%8d%e6%9c%89%e4%bb%bb%e5%8a%a1%e5%b0%b1%e5%88%9b%e5%bb%ba%e7%ba%bf%e7%a8%8b%e5%b8%a6%e6%9d%a5%e7%9a%84%e9%a2%9d%e5%a4%96%e7%9a%84%e5%bc%80%e9%94%80%ef%bc%8c%e5%8f%a6%e4%b8%80%e6%96%b9%e9%9d%a2%e4%b9%9f%e6%98%af%e4%bf%9d%e6%8a%a4%e6%9c%8d%e5%8a%a1%e5%99%a8%e4%ba%a7%e7%94%9f%e8%bf%87%e5%a4%9a%e7%9a%84%e7%ba%bf%e7%a8%8b%e6%95%b0%e9%87%8f%e3%80%82%0a%e7%ba%bf%e7%a8%8b%e6%b1%a0%e8%a7%a3%e5%86%b3%e4%bb%80%e4%b9%88%e9%97%ae%e9%a2%98%20%e7%ba%bf%e7%a8%8b%e6%b1%a0%e8%a7%a3%e5%86%b3%e7%9a%84%e6%a0%b8%e5%bf%83%e9%97%ae%e9%a2%98%e6%98%af%e8%b5%84%e6%ba%90%e7%ae%a1%e7%90%86%e9%97%ae%e9%a2%98%ef%bc%8c%e5%9c%a8%e5%b9%b6%e5%8f%91%e7%8e%af%e5%a2%83%e4%b8%8b%ef%bc%8c%e7%b3%bb%e7%bb%9f%e5%92%8c%e6%9c%8d%e5%8a%a1%e5%b9%b6%e4%b8%8d%e7%9f%a5%e9%81%93%e5%9c%a8%e4%bb%80%e4%b9%88%e6%97%b6%e5%80%99%e9%9c%80%e8%a6%81%e5%a4%9a%e5%b0%91%e8%b5%84%e6%ba%90%e3%80%82%e8%80%8c%20%e6%b1%a0%e5%8c%96%28Pooling%29%20%e6%80%9d%e6%83%b3%ef%bc%8c%e5%b0%b1%e6%98%af%e4%b8%ba%e4%ba%86%e5%b0%86%e8%b5%84%e6%ba%90%e7%bb%9f%e4%b8%80%e7%ae%a1%e7%90%86%e7%9a%84%e6%83%85%e5%86%b5%e4%b8%8b%ef%bc%8c%e5%87%8f%e5%b0%8f%e9%a3%8e%e9%99%a9%e7%9a%84%e6%80%9d%e6%83%b3%e3%80%82%0aWiki%e4%b8%8a%20ThreadPool%e5%9b%be%0aP.S%20%3a%20%e6%b1%a0%e5%8c%96%e6%80%9d%e6%83%b3%e4%b8%be%e4%be%8b%0a%e5%86%85%e5%ad%98%e6%b1%a0%28Memory%20Pool%29%20%e5%af%b9%e8%b1%a1%e6%b1%a0%28Object%20Pool%29%20%e5%8d%b3%e5%ae%9e%e4%be%8b%e6%b1%a0%20%e8%bf%9e%e6%8e%a5%e6%b1%a0%28Connection%20Pool%29%20%e7%ba%bf%e7%a8%8b%e6%b1%a0%e6%a0%b8%e5%bf%83%e8%ae%be%e8%ae%a1%20%e5%9c%a8%e7%9c%8b%e7%ba%bf%e7%a8%8b%e6%b1%a0%e7%9a%84%e8%ae%be%e8%ae%a1%e4%b9%8b%e5%89%8d%ef%bc%8c%e5%85%88%e4%ba%86%e8%a7%a3%e4%b8%80%e4%b8%8b%e7%ba%bf%e7%a8%8b%e6%b1%a0%e7%9a%84%e6%9e%84%e9%80%a0%e5%8f%82%e6%95%b0%0acorePoolSize%20%e2%80%93%20the%20number%20of%20threads%20to%20keep%20in%20the%20pool%2c%20even%20if%20they%20are%20idle%2c%20unless%20allowCoreThreadTimeOut%20is%20set%20maximumPoolSize%20%e2%80%93%20the%20maximum%20number%20of%20threads%20to%20allow%20in%20the%20pool%20keepAliveTime%20%e2%80%93%20when%20the%20number%20of%20threads%20is%20greater%20than%20the%20core%2c%20this%20is%20the%20maximum%20time%20that%20excess%20idle%20threads%20will%20wait%20for%20new%20tasks%20before%20terminating." aria-label=Tumblr><i class="fab fa-tumblr" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fpinkhello.cc%2fposts%2f47-%25E7%25BB%2586%25E8%25B0%2588%25E7%25BA%25BF%25E7%25A8%258B%25E6%25B1%25A0%25E8%25AE%25BE%25E8%25AE%25A1%25E4%25B8%258E%25E7%259B%2591%25E6%258E%25A7%2f&t=%e7%bb%86%e8%b0%88%e7%ba%bf%e7%a8%8b%e6%b1%a0%e8%ae%be%e8%ae%a1%e4%b8%8e%e7%9b%91%e6%8e%a7" aria-label="Hacker News"><i class="fab fa-hacker-news" aria-hidden=true></i></a></li></ul></div></span></div><article class=post itemscope itemtype=http://schema.org/BlogPosting><header><h1 class=posttitle itemprop="name headline">ç»†è°ˆçº¿ç¨‹æ± è®¾è®¡ä¸ç›‘æ§</h1><div class=meta><div class=postdate><time datetime="2022-03-05 22:05:23 +0800 +0800" itemprop=datePublished>2022-03-05</time></div><div class=article-category><i class="fas fa-archive"></i>
<a class=category-link href=/categories/tech>Tech</a></div><div class=article-tag><i class="fas fa-tag"></i>
<a class=tag-link href=/tags/algorithms rel=tag>Algorithms</a></div></div></header><div id=toc><nav id=TableOfContents><ul><li><a href=#çº¿ç¨‹æ± ç®€ä»‹>çº¿ç¨‹æ± ç®€ä»‹</a></li><li><a href=#çº¿ç¨‹æ± è§£å†³ä»€ä¹ˆé—®é¢˜>çº¿ç¨‹æ± è§£å†³ä»€ä¹ˆé—®é¢˜</a></li></ul><ul><li><a href=#çº¿ç¨‹æ± æ€»æ¡†æ¶è®¾è®¡>çº¿ç¨‹æ± æ€»æ¡†æ¶è®¾è®¡</a></li><li><a href=#çº¿ç¨‹æ± çš„ç”Ÿå‘½å‘¨æœŸ>çº¿ç¨‹æ± çš„ç”Ÿå‘½å‘¨æœŸ</a></li></ul><ul><li><a href=#ä»»åŠ¡>ä»»åŠ¡</a><ul><li><a href=#ä»»åŠ¡æäº¤>ä»»åŠ¡æäº¤</a></li><li><a href=#ä»»åŠ¡è°ƒåº¦æ‰§è¡Œ>ä»»åŠ¡è°ƒåº¦æ‰§è¡Œ</a></li><li><a href=#ä»»åŠ¡æ‰§è¡Œç¼“å†²>ä»»åŠ¡æ‰§è¡Œç¼“å†²</a></li><li><a href=#ä»»åŠ¡æ‹’ç»>ä»»åŠ¡æ‹’ç»</a></li></ul></li><li><a href=#çº¿ç¨‹>çº¿ç¨‹</a><ul><li><a href=#å·¥ä½œçº¿ç¨‹>å·¥ä½œçº¿ç¨‹</a></li><li><a href=#å·¥ä½œçº¿ç¨‹çš„å¢åŠ >å·¥ä½œçº¿ç¨‹çš„å¢åŠ </a></li><li><a href=#å·¥ä½œçº¿ç¨‹çš„é‡Šæ”¾-å’Œ-æ‰§è¡Œä»»åŠ¡>å·¥ä½œçº¿ç¨‹çš„é‡Šæ”¾ å’Œ æ‰§è¡Œä»»åŠ¡</a></li></ul></li></ul></nav></div><div class=content itemprop=articleBody><h1 id=å‰è¨€>å‰è¨€</h1><p>ä¸‡å¹´å…«è‚¡æ–‡ï¼Œåœ¨å·¥ä½œä¸­è‚¯å®šå¤šå¤šå°‘å°‘éƒ½ä½¿ç”¨äº†<code>çº¿ç¨‹æ± </code>ï¼Œä½†æœ‰æ²¡æœ‰çœŸæ­£çš„å»äº†è§£<code>çº¿ç¨‹æ± </code>çš„æ•´ä¸ªè¿è¡Œæœºåˆ¶å’Œæ ¸å¿ƒå…³é”®ç‚¹ã€‚ä»Šå¤©åˆ†äº«ä¸€ä¸‹ã€‚</p><h2 id=çº¿ç¨‹æ± ç®€ä»‹>çº¿ç¨‹æ± ç®€ä»‹</h2><p>å…ˆè¯´ <code>çº¿ç¨‹(Thread)</code> , åœ¨ <code>Wiki</code> çš„è§£é‡Šæ˜¯<code>æ“ä½œç³»ç»Ÿèƒ½è¿›è¡Œè¿ç®—è°ƒåº¦çš„æœ€å°å•å…ƒ</code>ã€‚åŒ…å«åœ¨è¿›ç¨‹ä¸­ï¼Œæ˜¯<code>è¿›ç¨‹å®é™…è¿ä½œçš„å•å…ƒ</code>ã€‚
OKï¼Œå…ˆè®°ä½è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬è¯´ <a href=https://en.wikipedia.org/wiki/Thread_pool><code>çº¿ç¨‹æ± (Thread Pool)</code></a> ï¼Œé¡¾åæ€ä¹‰ï¼ŒåŸºäº<code>æ± åŒ–æ€æƒ³</code>çš„ç®¡ç†çº¿ç¨‹çš„æ‰‹æ®µï¼ˆå·¥å…·ï¼‰ã€‚æ—¢ç„¶å«çº¿ç¨‹æ± äº†ï¼Œå¯ä»¥
çŸ¥é“è‚¯å®šæ˜¯<code>å¤šçº¿ç¨‹</code>çš„æœåŠ¡ç¯å¢ƒä¸‹ã€‚</p><p>æˆ‘ä»¬éƒ½çŸ¥é“<code>Server</code>çš„èµ„æºæ˜¯æœ‰é™çš„ï¼Œä¸å¯èƒ½æ— æ­¢å¢ƒçš„æ‰©å¼ ï¼ˆä»æˆæœ¬ã€è¿ç»´ä¸Šè€ƒè™‘ï¼‰ã€‚çº¿ç¨‹è¿‡åˆ†çš„å¼€è¾Ÿçš„è¯ï¼Œä¼šå¯¼è‡´æ•´ä½“æœåŠ¡å™¨èµ„æºåƒç´§ï¼ˆçº¿ç¨‹å¸¦æ¥çš„å¼€é”€ã€åˆ›å»ºã€è°ƒåº¦ç­‰ç­‰ï¼‰ã€‚
æ± åŒ–çš„æ€æƒ³ï¼Œçº¿ç¨‹æ± ç»´æŠ¤ç€å¤šä¸ªçº¿ç¨‹ï¼Œç­‰å¾…è°ƒåº¦åˆ†é…å¹¶å‘ä»»åŠ¡å»æ‰§è¡Œã€‚ä¸€æ–¹é¢é¿å…æœ‰ä»»åŠ¡å°±åˆ›å»ºçº¿ç¨‹å¸¦æ¥çš„é¢å¤–çš„å¼€é”€ï¼Œå¦ä¸€æ–¹é¢ä¹Ÿæ˜¯ä¿æŠ¤æœåŠ¡å™¨äº§ç”Ÿè¿‡å¤šçš„çº¿ç¨‹æ•°é‡ã€‚</p><h2 id=çº¿ç¨‹æ± è§£å†³ä»€ä¹ˆé—®é¢˜>çº¿ç¨‹æ± è§£å†³ä»€ä¹ˆé—®é¢˜</h2><p><code>çº¿ç¨‹æ± </code>è§£å†³çš„æ ¸å¿ƒé—®é¢˜æ˜¯<code>èµ„æºç®¡ç†</code>é—®é¢˜ï¼Œåœ¨å¹¶å‘ç¯å¢ƒä¸‹ï¼Œç³»ç»Ÿå’ŒæœåŠ¡å¹¶ä¸çŸ¥é“åœ¨ä»€ä¹ˆæ—¶å€™éœ€è¦å¤šå°‘èµ„æºã€‚è€Œ <code>æ± åŒ–(Pooling)</code> æ€æƒ³ï¼Œå°±æ˜¯ä¸ºäº†å°†èµ„æºç»Ÿä¸€ç®¡ç†çš„æƒ…å†µä¸‹ï¼Œå‡å°é£é™©çš„æ€æƒ³ã€‚</p><p><code>Wiki</code>ä¸Š <code>ThreadPool</code>å›¾</p><p><img src=/%E7%BB%86%E8%AF%B4%E7%BA%BF%E7%A8%8B%E6%B1%A0/thread_pool.svg.png alt=TheadPool></p><p>P.S : æ± åŒ–æ€æƒ³ä¸¾ä¾‹</p><ul><li><a href=https://en.wikipedia.org/wiki/Memory_pool>å†…å­˜æ± (<code>Memory</code> <code>Pool</code>)</a></li><li><a href=https://en.wikipedia.org/wiki/Object_pool_pattern>å¯¹è±¡æ± (<code>Object</code> <code>Pool</code>) å³å®ä¾‹æ± </a></li><li><a href=https://en.wikipedia.org/wiki/Connection_pool>è¿æ¥æ± (<code>Connection</code> <code>Pool</code>)</a></li></ul><h1 id=çº¿ç¨‹æ± æ ¸å¿ƒè®¾è®¡>çº¿ç¨‹æ± æ ¸å¿ƒè®¾è®¡</h1><p>åœ¨çœ‹çº¿ç¨‹æ± çš„è®¾è®¡ä¹‹å‰ï¼Œå…ˆäº†è§£ä¸€ä¸‹çº¿ç¨‹æ± çš„æ„é€ å‚æ•°</p><ul><li><code>corePoolSize</code> â€“ the number of threads to keep in the pool, even if they are idle, unless allowCoreThreadTimeOut is set</li><li><code>maximumPoolSize</code> â€“ the maximum number of threads to allow in the pool</li><li><code>keepAliveTime</code> â€“ when the number of threads is greater than the core, this is the maximum time that excess idle threads will wait for new tasks before terminating.</li><li><code>unit</code> â€“ the time unit for the keepAliveTime argument</li><li><code>workQueue</code> â€“ the queue to use for holding tasks before they are executed. This queue will hold only the Runnable tasks submitted by the execute method.</li><li><code>threadFactory</code> â€“ the factory to use when the executor creates a new thread</li><li><code>handler</code> â€“ the handler to use when execution is blocked because the thread bounds and queue capacities are reached</li></ul><p>åºŸè¯å¤ªå¤šäº†ï¼Œç›´æ¥ä¸Š<code>UML</code>å›¾</p><h2 id=çº¿ç¨‹æ± æ€»æ¡†æ¶è®¾è®¡>çº¿ç¨‹æ± æ€»æ¡†æ¶è®¾è®¡</h2><p>å®ç°ç±» <code>ThreadPoolExecutor</code> <code>UML</code> å›¾</p><p><img src=/%E7%BB%86%E8%AF%B4%E7%BA%BF%E7%A8%8B%E6%B1%A0/%E7%B1%BB%E5%9B%BE.png alt=ç±»å›¾></p><ul><li>é¡¶çº§æ¥å£ <code>Executor</code> åªæœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³• <code>void execute(Runnable)</code> æ–¹æ³•ï¼Œè¿™æ˜¯å°† <code>ä»»åŠ¡</code> å’Œ <code>çº¿ç¨‹</code> è§£è€¦ï¼Œç”¨æˆ·åªéœ€è¦æä¾› <code>Runnable</code> å¯¹è±¡ï¼Œä¸éœ€è¦å…³ç³»å¦‚ä½•åˆ›å»ºçº¿ç¨‹ã€å¦‚ä½•è°ƒåº¦çº¿ç¨‹æ‰§è¡Œä»»åŠ¡ã€‚</li><li>ä¸‹å±‚çš„ <code>ExecutorService</code> æä¾›äº†è¯¸å¤šæ–¹æ³•ï¼Œè¿™æ˜¯å¯¹ <code>Executor</code> è¿›è¡Œäº†èƒ½åŠ›æ‰©å……ï¼šæ‰§è¡Œä»»åŠ¡ï¼ˆåŒæ­¥ã€å¼‚æ­¥ï¼‰<code>Future</code> çš„æ–¹æ³•ã€åœæ­¢çº¿ç¨‹æ± å’Œä¸­æ–­çº¿ç¨‹ç­‰æ–¹æ³•</li><li><code>AbstractExecutorService</code> æ˜¯ä¸€ä¸ªæŠ½è±¡çš„å®ç°ï¼ŒæŸ¥çœ‹æºç  <code>invokeAll</code> <code>invokeAny</code> <code>doInvokeAny</code> èƒ½å‘ç°ï¼Œè¿™æ˜¯å°† <code>çº¿ç¨‹</code> ä¸ <code>ä»»åŠ¡</code> ç»“åˆæµè½¬çš„å®ç°ï¼Œä¿è¯ä¸Šå±‚åªéœ€è¦å…³å¿ƒ <code>execute</code> æ–¹æ³•å°±å¯ä»¥äº†ã€‚</li><li>æœ€ä¸‹é¢çš„ <code>ThreadPoolExecutor</code> å®ç°äº†æœ€éº»çƒ¦çš„è¿è¡Œéƒ¨åˆ†ï¼ŒåŒæ—¶ç»´æŠ¤è¿™çº¿ç¨‹æ± çš„ç”Ÿå‘½å‘¨æœŸã€è¿˜è¦ç®¡ç†çº¿ç¨‹å’Œä»»åŠ¡ï¼Œåœ¨æ­¤ï¼Œ<code>ä»»åŠ¡çš„æäº¤</code>ã€<code>çº¿ç¨‹ç®¡ç†</code>ã€<code>ç›‘æ§</code>ç­‰ç­‰</li></ul><p>ä¸‹é¢è¯·çœ‹å›¾</p><p><img src=/%E7%BB%86%E8%AF%B4%E7%BA%BF%E7%A8%8B%E6%B1%A0/%E7%BA%BF%E7%A8%8B%E6%B1%A0%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B.png alt=çº¿ç¨‹æ± æ‰§è¡Œæµç¨‹></p><ul><li>ä»ä¸Šå›¾ä¸­çœ‹åˆ°çœ‹åˆ°äº†ä»»åŠ¡åœ¨æäº¤åæ•´ä¸ªçš„æ‰§è¡Œæµç¨‹ã€çº¿ç¨‹æ± å†…éƒ¨å°±æ˜¯ä¸€ä¸ªæ„å»ºäº†<code>ç”Ÿäº§è€…``æ¶ˆè´¹è€…</code>æ¨¡å‹ï¼Œå¹¶å°†çº¿ç¨‹ä¸ä»»åŠ¡è¿›è¡Œäº†è§£è€¦ã€‚</li><li>é€šè¿‡ <code>ç¼“å†²ä»»åŠ¡</code> + <code>çº¿ç¨‹ç»„</code> æ¨¡å¼ï¼Œè¾¾åˆ°å¤ç”¨çº¿ç¨‹çš„ç›®çš„</li><li>ä»»åŠ¡éƒ¨åˆ†ï¼Œ<code>ç”Ÿäº§è€…</code>ã€‚æäº¤ä»»åŠ¡ï¼Œåˆ¤æ–­æ˜¯è¿›å…¥å“ªç§æ‰§è¡Œæµç¨‹ï¼šç¬¬ä¸€ã€è¿›å…¥ç¼“å†²ä»»åŠ¡é˜Ÿåˆ—ï¼›ç¬¬äºŒã€ç›´æ¥å¼€è¾Ÿçº¿ç¨‹æ‰§è¡Œï¼›ç¬¬ä¸‰ã€æ‰§è¡Œæ‹’ç»</li><li>çº¿ç¨‹ç®¡ç†ï¼Œ<code>æ¶ˆè´¹è€…</code>ã€‚çº¿ç¨‹æ± ç»´æŠ¤ä¸€å®šçš„çº¿ç¨‹ï¼Œçº¿ç¨‹æ‰§è¡Œå®Œæ¯•åä¼šç»§ç»­è·å–æ–°çš„ä»»åŠ¡å»æ‰§è¡Œï¼Œå¦‚æœæ²¡æœ‰æ–°çš„ä»»åŠ¡ï¼Œçº¿ç¨‹è¢«å›æ”¶ã€‚</li></ul><h2 id=çº¿ç¨‹æ± çš„ç”Ÿå‘½å‘¨æœŸ>çº¿ç¨‹æ± çš„ç”Ÿå‘½å‘¨æœŸ</h2><p>è¦äº†è§£çº¿ç¨‹æ± çš„ç”Ÿå‘½å‘¨æœŸè¿è¡Œï¼Œå°±è‚¯å®šè¦å»çœ‹ <code>ThreadPoolExecutor</code> çš„æºç ï¼Œä»ä»£ç ä¸Šå¯ä»¥çœ‹åˆ°ä¸€ä¸ªæ ¸å¿ƒçš„å‚æ•°ï¼Œ</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> AtomicInteger ctl <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> AtomicInteger<span style=color:#f92672>(</span>ctlOf<span style=color:#f92672>(</span>RUNNING<span style=color:#f92672>,</span> 0<span style=color:#f92672>));</span>
</span></span></code></pre></div><p>ä»æ˜¯ç§æœ‰ç±»å‹å¯ä»¥çŸ¥é“ï¼Œè¿™ä¸ªä¸æ˜¯ç”¨æˆ·æ˜¾æ€§è®¾ç½®çš„ï¼Œè¿™æ˜¯ç”±çº¿ç¨‹æ± è¿è¡Œçš„æ—¶å€™ï¼Œç”±å†…éƒ¨æ¥ç»´æŠ¤çš„ã€‚é‚£å®ƒå¹²å•¥ç”¨çš„å‘¢ï¼Ÿ</p><p>é¦–å…ˆï¼Œå®ƒæ˜¯ä¸€ä¸ª <code>AtomicInteger</code> ç±»å‹ï¼Œä¹Ÿå³æ˜¯å®ƒæ˜¯ä¸»è¦çš„æ§åˆ¶çŠ¶æ€ï¼ŒåŒ…å«äº†ä¸¤ä¸ªå…³é”®æ€§æ¦‚å¿µï¼ˆä¸€ä¸ªint <code>32 ä½</code>ï¼‰</p><ul><li><code>workerCount</code> ï¼ˆ<code>ä½29ä½</code>ï¼‰è¡¨ç¤ºæœ‰æ•ˆçš„çº¿ç¨‹æ•°ï¼Œä»¥åŠå¼€å¯çš„çº¿ç¨‹æ•°</li><li><code>runState</code> ï¼ˆ<code>é«˜3ä½</code>ï¼‰è®°å½•æ­£åœ¨å¤„äº <code>Running</code>ã€<code>Shutting down</code> çŠ¶æ€ï¼Œè¿™ä¸ªæ˜¯ä¸»è¦çš„ç”Ÿå‘½å‘¨æœŸæ§åˆ¶</li></ul><p>ä»æ³¨é‡Šä¸Šçœ‹å‡ºï¼Œ<code>runState</code> ä¸»è¦çš„å–å€¼æœ‰</p><ul><li><code>RUNNING</code> æ¥æ”¶æ–°çš„ä»»åŠ¡ï¼Œå¹¶ä¸”å¤„ç†è¿›å…¥<code>Queue</code>çš„ä»»åŠ¡</li><li><code>SHUTDOWN</code> ä¸èƒ½æ¥æ”¶æ–°çš„ä»»åŠ¡ï¼Œä½†æ˜¯ç»§ç»­å¤„ç†è¿›å…¥<code>Queue</code>çš„ä»»åŠ¡</li><li><code>STOP</code> ä¸æ¥å—æ–°çš„ä»»åŠ¡ï¼Œä¹Ÿä¸å¤„ç†è¿›å…¥Queue çš„ä»»åŠ¡ï¼Œå¹¶ä¸”å½“å‰æ­£åœ¨å¤„ç†çš„ä»»åŠ¡ä¸­æ–­</li><li><code>TIDYING</code> å½“æ‰€æœ‰çš„ä»»åŠ¡éƒ½ç»ˆæ­¢ã€<code>workCount=0</code>ï¼Œçº¿ç¨‹æ± çŠ¶æ€è½¬æ¢åˆ° <code>TIDYING</code>ï¼Œåç»­è¿è¡Œ <code>terminate() hook</code> æ–¹æ³•ã€‚</li><li><code>TERMINATED</code> <code>terminate()</code>æ–¹æ³•æ‰§è¡Œå®Œæ¯•</li></ul><p><img src=/%E7%BB%86%E8%AF%B4%E7%BA%BF%E7%A8%8B%E6%B1%A0/%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E7%8A%B6%E6%80%81%E5%8F%98%E5%8C%96.png alt=çº¿ç¨‹æ± ç”Ÿå‘½å‘¨æœŸçŠ¶æ€å˜åŒ–></p><p><code>runState</code> çš„å–å€¼å˜åŒ–æ˜¯æœ‰é¡ºåºçš„</p><ul><li><code>RUNNING</code> -> <code>SHUTDOWN</code><blockquote><p>On invocation of shutdown()</p></blockquote></li><li>(<code>RUNNING</code> OR <code>SHUTDOWN</code>) -> <code>STOP</code><blockquote><p>On invocation of shutdownNow()</p></blockquote></li><li><code>SHUTDOWN</code> -> <code>TIDYING</code><blockquote><p>When both queue and pool are empty</p></blockquote></li><li><code>STOP</code> -> <code>TIDYING</code><blockquote><p>When pool is empty</p></blockquote></li><li><code>TIDYING</code> -> <code>TERMINATED</code><blockquote><p>When the terminated() hook method has completedÃ¥</p></blockquote></li></ul><h1 id=çº¿ç¨‹æ± å…³é”®æ¦‚å¿µ>çº¿ç¨‹æ± å…³é”®æ¦‚å¿µ</h1><p>ä¸Šé¢æåˆ°çº¿ç¨‹æ± æ˜¯è§£è€¦ï¼Œ<code>ä»»åŠ¡</code> å’Œ <code>çº¿ç¨‹</code> çš„å…³ç³»ã€‚è¿™æ ·çš„è¯å°±æ‹†åˆ†å‡ºä¸¤ä¸ªå…³é”®çš„æ¦‚å¿µç‚¹</p><h2 id=ä»»åŠ¡>ä»»åŠ¡</h2><p>ç»“åˆä»£ç ä¸Šä»æ–¹æ³•åç§°ä¸Šæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å‡ ä¸ªæ ¸å¿ƒçš„æ–¹æ³•</p><ul><li><code>Executor#execute</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>  <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>execute</span><span style=color:#f92672>(</span>Runnable command<span style=color:#f92672>);</span>
</span></span></code></pre></div><ul><li><code>ExecutorService#submit</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>  Future<span style=color:#f92672>&lt;?&gt;</span> submit<span style=color:#f92672>(</span>Runnable task<span style=color:#f92672>);</span>
</span></span></code></pre></div><ul><li><code>AbstractExecutorService#submit</code> å®ç°</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>    <span style=color:#66d9ef>public</span> Future<span style=color:#f92672>&lt;?&gt;</span> submit<span style=color:#f92672>(</span>Runnable task<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>task <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> NullPointerException<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        RunnableFuture<span style=color:#f92672>&lt;</span>Void<span style=color:#f92672>&gt;</span> ftask <span style=color:#f92672>=</span> newTaskFor<span style=color:#f92672>(</span>task<span style=color:#f92672>,</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        execute<span style=color:#f92672>(</span>ftask<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> ftask<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span></code></pre></div><p>ä»ä¸Šè¿°ä¸Šå¯ä»¥çœ‹å‡ºï¼Œä»»åŠ¡çš„æäº¤åˆ°æ‰§è¡Œçš„æµç¨‹æœ€ç»ˆéƒ½æ˜¯æ‰§è¡Œ<code>execute</code>çš„æ–¹æ³•ã€‚</p><h3 id=ä»»åŠ¡æäº¤>ä»»åŠ¡æäº¤</h3><p>ä»»åŠ¡æäº¤ï¼Œå€ŸåŠ© <code>newTaskFor</code> å°† <code>Runnable</code> å¯¹è±¡æ„é€ æˆ <code>RunnableFuture</code> å¯¹è±¡ä½œä¸ºä»»åŠ¡ä¼ é€’è¿›å…¥ã€‚</p><h3 id=ä»»åŠ¡è°ƒåº¦æ‰§è¡Œ>ä»»åŠ¡è°ƒåº¦æ‰§è¡Œ</h3><p>ä»»åŠ¡çš„è°ƒåº¦å°±æ˜¯ <code>execute</code> æ–¹æ³•, ä¸»è¦çš„å·¥ä½œ: æ£€æŸ¥çº¿ç¨‹æ± è¿è¡ŒçŠ¶æ€ã€è¿è¡Œçº¿ç¨‹æ•°ã€è¿è¡Œç­–ç•¥ï¼Œå†³å®šåç»­èµ°ç”³è¯·çº¿ç¨‹æ‰§è¡Œã€æˆ–ç¼“å†²åˆ°é˜Ÿåˆ—ä¸­å»ï¼Œæˆ–ç›´æ¥æ‹’ç»è¯¥ä»»åŠ¡</p><p>å¤§ä½“æ‰§è¡Œçš„:</p><ul><li><code>workCount</code> &lt; <code>corePoolSize</code>, ç›´æ¥å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œæ–°æäº¤çš„ä»»åŠ¡ï¼ˆ<code>addWorker</code>å†…éƒ¨ å½“å‰ä»»åŠ¡ä½œä¸ºè¿™ä¸ªçº¿ç¨‹çš„<code>firstTask</code>æ‰§è¡Œï¼‰</li><li><code>workCount</code> >= <code>corePoolSize</code>, <code>workQueue</code> æœªæ»¡ï¼Œåˆ™åŠ å…¥åˆ° <code>workQueue</code>ã€‚</li><li><code>workCount</code> >= <code>corePoolSize</code>, <code>workCount</code> &lt; <code>maximumPoolSize</code>, <code>workQueue</code> å·²æ»¡ï¼Œåˆ›å»ºæ–°çš„çº¿ç¨‹æ‰§è¡Œ</li><li><code>workCount</code> >= <code>maximumPoolSize</code>, <code>workQueue</code> å·²æ»¡ï¼Œæ‰§è¡Œæ‹’ç»ç­–ç•¥</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>execute</span><span style=color:#f92672>(</span>Runnable command<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>command <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> NullPointerException<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span> c <span style=color:#f92672>=</span> ctl<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// workCount &lt; corePoolSizeæ•°ç›®ï¼Œæ·»åŠ æ–°çš„ worker æ‰§è¡Œä»»åŠ¡ï¼Œå½“å‰çš„ä»»åŠ¡ä½œä¸ºæ–°åŠ çº¿ç¨‹çš„ FirstTask
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>workerCountOf<span style=color:#f92672>(</span>c<span style=color:#f92672>)</span> <span style=color:#f92672>&lt;</span> corePoolSize<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// æ·»åŠ æˆåŠŸï¼Œç›´æ¥è¿”å›ï¼Œä¸æˆåŠŸçš„è¯ï¼Œè¯´æ˜å½“å‰çº¿ç¨‹æ± ä¸å…è®¸æäº¤ä»»åŠ¡
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>addWorker<span style=color:#f92672>(</span>command<span style=color:#f92672>,</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            c <span style=color:#f92672>=</span> ctl<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>// èƒ½æ‰§è¡Œåˆ°è¿™é‡Œï¼Œè¯´æ˜äº† workCount &gt;= corePoolSize æˆ–è€… çº¿ç¨‹æ± ä¸å…è®¸æäº¤ä»»åŠ¡äº†
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>// æ£€æŸ¥çº¿ç¨‹æ±  RUNNING çŠ¶æ€ï¼ŒæŠŠä»»åŠ¡æ·»åŠ åˆ° ä»»åŠ¡Queueä¸­
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>isRunning<span style=color:#f92672>(</span>c<span style=color:#f92672>)</span> <span style=color:#f92672>&amp;&amp;</span> workQueue<span style=color:#f92672>.</span><span style=color:#a6e22e>offer</span><span style=color:#f92672>(</span>command<span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>//è¿›å…¥å½“å‰åˆ†æ”¯ï¼Œ ä»»åŠ¡æ·»åŠ è¿›å…¥äº† workQueueä¸­ã€‚workCount åœ¨[0,corePoolSize) æ— æ¡ä»¶å¼€å¯æ–°çš„çº¿ç¨‹ï¼Œå½“ &gt; corePoolSize ä»»åŠ¡åŠ å…¥Queue
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>int</span> recheck <span style=color:#f92672>=</span> ctl<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>//å¦‚æœçº¿ç¨‹ä¸å¤„äºRunningçŠ¶æ€ï¼Œé‚£ä¹ˆç§»é™¤å·²ç»å…¥é˜Ÿçš„ä»»åŠ¡ï¼Œå¹¶æ‰§è¡Œ reject ç­–ç•¥
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(!</span> isRunning<span style=color:#f92672>(</span>recheck<span style=color:#f92672>)</span> <span style=color:#f92672>&amp;&amp;</span> remove<span style=color:#f92672>(</span>command<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>                reject<span style=color:#f92672>(</span>command<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>//å¦‚æœçº¿ç¨‹æ± å¤„äºRunningï¼Œä¸”çº¿ç¨‹æ•°é‡ä¸º 0 ï¼Œå¼€å¯æ–°çš„çº¿ç¨‹ï¼ˆè¿™è¾¹æ˜¯å› ä¸ºæˆ‘ä»¬ä»»åŠ¡å·²ç»æäº¤åˆ°Queueä¸­ï¼Œä½†æ˜¯çº¿ç¨‹éƒ½å…³é—­äº†æ€ä¹ˆåŠï¼‰
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>workerCountOf<span style=color:#f92672>(</span>recheck<span style=color:#f92672>)</span> <span style=color:#f92672>==</span> 0<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>                addWorker<span style=color:#f92672>(</span><span style=color:#66d9ef>null</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// å¦‚æœ workQueue æ»¡äº†ï¼Œä»¥ maximumPoolSize ä¸ºæœ€å¤§å€¼åˆ›å»ºæ–°çš„çº¿ç¨‹ï¼Œåˆ›å»ºå¤±è´¥çš„è¯ï¼Œåˆ™æ‰§è¡Œæ‹’ç»ç­–ç•¥
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> <span style=color:#f92672>(!</span>addWorker<span style=color:#f92672>(</span>command<span style=color:#f92672>,</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>            reject<span style=color:#f92672>(</span>command<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span></code></pre></div><h3 id=ä»»åŠ¡æ‰§è¡Œç¼“å†²>ä»»åŠ¡æ‰§è¡Œç¼“å†²</h3><p><code>workQueue</code> æ˜¯çº¿ç¨‹æ± ç®¡ç†ä»»åŠ¡çš„æ ¸å¿ƒéƒ¨åˆ†, <code>workQueue</code> ä»ä»£ç ä¸Šçœ‹æ˜¯ä¸€ä¸ªé˜»å¡é˜Ÿåˆ—ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> BlockingQueue<span style=color:#f92672>&lt;</span>Runnable<span style=color:#f92672>&gt;</span> workQueue<span style=color:#f92672>;</span>
</span></span></code></pre></div><p>ä»æ³¨é‡Šä¸Šçš„çœ‹ï¼Œè¿™ä¸ª<code>queue</code>ï¼Œç”¨äºä¿å­˜ä»»åŠ¡ï¼Œå¹¶ä¸”ç§»äº¤ä»»åŠ¡ç»™ <code>worker thread</code>ã€‚</p><ul><li>å½“ <code>Queue</code> ä¸ºç©ºæ—¶å€™ï¼Œè·å–å…ƒç´ çš„çº¿ç¨‹ç­‰å¾… <code>Queue</code> å˜æˆéç©º</li><li>å½“ <code>Queue</code> æ»¡äº†ï¼Œå­˜å‚¨å…ƒç´ çš„çº¿ç¨‹ç­‰å¾…é˜Ÿåˆ—å¯ç”¨ã€‚</li></ul><p>çº¿ç¨‹åœ¨æ‰§è¡Œä¸­æ˜¯æ‰§è¡Œä»»åŠ¡ï¼Œé‚£ä¹ˆçº¿ç¨‹å¦‚ä½•ä» <code>Queue</code> è·å–ä»»åŠ¡çš„å‘¢ï¼Ÿçœ‹ <code>GetTask</code> æ–¹æ³•</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>private</span> Runnable <span style=color:#a6e22e>getTask</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>boolean</span> timedOut <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>;</span> <span style=color:#75715e>// Did the last poll() time out?
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> <span style=color:#f92672>(;;)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>int</span> c <span style=color:#f92672>=</span> ctl<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// ä¸¤ç§æƒ…å†µ: 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#75715e>//   1. runState == SHUTDOWN &amp;&amp; workQueue.isEmpty()
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#75715e>//   2. runState &gt;= STOP
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#75715e>// Check if queue empty only if necessary.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>runStateAtLeast<span style=color:#f92672>(</span>c<span style=color:#f92672>,</span> SHUTDOWN<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>(</span>runStateAtLeast<span style=color:#f92672>(</span>c<span style=color:#f92672>,</span> STOP<span style=color:#f92672>)</span> <span style=color:#f92672>||</span> workQueue<span style=color:#f92672>.</span><span style=color:#a6e22e>isEmpty</span><span style=color:#f92672>()))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                <span style=color:#75715e>//CAS æ“ä½œï¼Œ å‡å°‘ workCount å·¥ä½œçº¿ç¨‹æ•°
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                decrementWorkerCount<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>int</span> wc <span style=color:#f92672>=</span> workerCountOf<span style=color:#f92672>(</span>c<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// Are workers subject to culling?
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>boolean</span> timed <span style=color:#f92672>=</span> allowCoreThreadTimeOut <span style=color:#f92672>||</span> wc <span style=color:#f92672>&gt;</span> corePoolSize<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>((</span>wc <span style=color:#f92672>&gt;</span> maximumPoolSize <span style=color:#f92672>||</span> <span style=color:#f92672>(</span>timed <span style=color:#f92672>&amp;&amp;</span> timedOut<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>(</span>wc <span style=color:#f92672>&gt;</span> 1 <span style=color:#f92672>||</span> workQueue<span style=color:#f92672>.</span><span style=color:#a6e22e>isEmpty</span><span style=color:#f92672>()))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>compareAndDecrementWorkerCount<span style=color:#f92672>(</span>c<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>continue</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// workCount &lt;= maximumPoolSize ä¸”æ²¡æœ‰è¶…æ—¶
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                <span style=color:#75715e>// workQueue è·å–ä»»åŠ¡
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                Runnable r <span style=color:#f92672>=</span> timed <span style=color:#f92672>?</span>
</span></span><span style=display:flex><span>                    workQueue<span style=color:#f92672>.</span><span style=color:#a6e22e>poll</span><span style=color:#f92672>(</span>keepAliveTime<span style=color:#f92672>,</span> TimeUnit<span style=color:#f92672>.</span><span style=color:#a6e22e>NANOSECONDS</span><span style=color:#f92672>)</span> <span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>                    workQueue<span style=color:#f92672>.</span><span style=color:#a6e22e>take</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>r <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>return</span> r<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>                timedOut <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>InterruptedException retry<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                timedOut <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span></code></pre></div><p>åœ¨æ³¨é‡Šä¸Šæè¿°äº†è°ƒç”¨æ­¤æ–¹æ³•çš„å‡ ç§åœºæ™¯:</p><ul><li>ä»»åŠ¡æ‰§è¡Œé˜»å¡ï¼Œï¼ˆ <code>corePoolSize</code> ä¹‹å†…çš„çº¿ç¨‹ä¸ä¼šè¢«å›æ”¶ï¼Œå®ƒä»¬ä¸€ç›´ç­‰å¾…ä»»åŠ¡ï¼‰</li><li>å®šæ—¶ç­‰å¾…ï¼Œ<code>KeepAliveTime</code> ç”Ÿæ•ˆï¼ˆè¿™ä¹ˆé•¿æ—¶é—´éƒ½æ²¡æœ‰ä»»åŠ¡ï¼Œé‚£ä¹ˆçº¿ç¨‹åº”è¯¥å…³é—­ï¼‰</li><li>åœ¨å‘ç”Ÿä¸‹é¢çš„æƒ…å†µï¼Œå¿…é¡»è¿”å› <code>null</code>ï¼Œ å·¥ä½œçº¿ç¨‹å¿…é¡»é€€å‡ºï¼š<ul><li>çº¿ç¨‹æ±  ä¸­ <code>> maximumPoolSize</code> ä¸ª <code>worker</code> çº¿ç¨‹å­˜åœ¨(é€šè¿‡è°ƒç”¨ <code>setMaximumPoolSize</code> è®¾ç½®)</li><li>çº¿ç¨‹æ± å¤„äº <code>SHUTDOWN</code>ï¼Œä¸” <code>workQueue</code> ä¸ºç©ºï¼Œå°±æ˜¯ä¸æ¥å—æ–°çš„ä»»åŠ¡äº†</li><li>çº¿ç¨‹æ± å¤„äº <code>STOP</code>ï¼Œä¸ä»…ä¸æ¥å—æ–°çš„ä»»åŠ¡ï¼Œå·²ç»å­˜åœ¨ <code>workQueue</code> çš„çº¿ç¨‹ä¸åœ¨æ‰§è¡Œ</li><li>è¿™ä¸ªçº¿ç¨‹ç­‰å¾…ä»»åŠ¡è¶…æ—¶ï¼Œä¸”è¶…æ—¶çš„ <code>Worker</code>çº¿ç¨‹éšæ—¶å¯èƒ½è¢« <code>Terminate</code>,ï¼ˆ<code>workCount > corePoolSize</code> éƒ¨åˆ†çš„ çº¿ç¨‹ï¼‰</li></ul></li></ul><h3 id=ä»»åŠ¡æ‹’ç»>ä»»åŠ¡æ‹’ç»</h3><p>ä¸ºä»€ä¹ˆè¦æ‹’ç»ä»»åŠ¡å‘¢ï¼Œå› ä¸ºä»»åŠ¡æ‹’ç»æ¨¡å—æ˜¯çº¿ç¨‹æ± çš„ä¿æŠ¤æœºåˆ¶ï¼Œä»ä¸Šé¢æˆ‘ä»¬çŸ¥é“ï¼Œçº¿ç¨‹æ± æœ‰æœ€å¤§çš„å®¹é‡ï¼Œå½“çº¿ç¨‹æ± çš„ä»»åŠ¡ç¼“å­˜<code>Queue</code>æ»¡äº†åï¼Œå¹¶ä¸”çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°è¾¾åˆ°<code>maximumPoolSize</code>
æ—¶å€™ï¼Œå°±æ‹’ç»è¯¥ä»»åŠ¡äº†ï¼Œä¿æŠ¤çº¿ç¨‹æ± ã€‚</p><p>åœ¨ <code>execute(Runnable command)</code> æ–¹æ³•ä¸­æœ‰ <code>reject</code> æ–¹æ³•ï¼Œè¿™æ˜¯ä»»åŠ¡æ‹’ç»æ‰§è¡Œæ“ä½œã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>    <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>reject</span><span style=color:#f92672>(</span>Runnable command<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        handler<span style=color:#f92672>.</span><span style=color:#a6e22e>rejectedExecution</span><span style=color:#f92672>(</span>command<span style=color:#f92672>,</span> <span style=color:#66d9ef>this</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>RejectedExecutionHandler</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>rejectedExecution</span><span style=color:#f92672>(</span>Runnable r<span style=color:#f92672>,</span> ThreadPoolExecutor executor<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>åœ¨ <code>ThreadPoolExecutor</code> æœ‰å››ä¸ª <code>RejectedExecutionHandler</code> çš„å®ç°</p><ul><li><code>ThreadPoolExecutor.AbortPolicy</code> ä¸¢å¼ƒå¹¶ä¸”ç›´æ¥æŠ›å‡º <code>RejectedExecutionException</code>, é»˜è®¤çš„ç­–ç•¥</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>rejectedExecution</span><span style=color:#f92672>(</span>Runnable r<span style=color:#f92672>,</span> ThreadPoolExecutor e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> RejectedExecutionException<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Task &#34;</span> <span style=color:#f92672>+</span> r<span style=color:#f92672>.</span><span style=color:#a6e22e>toString</span><span style=color:#f92672>()</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>                                                 <span style=color:#e6db74>&#34; rejected from &#34;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>                                                 e<span style=color:#f92672>.</span><span style=color:#a6e22e>toString</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span></code></pre></div><ul><li><code>ThreadPoolExecutor.DiscardPolicy</code> ä»€ä¹ˆéƒ½ä¸åšï¼Œç›´æ¥ä¸¢å¼ƒä»»åŠ¡ï¼Œæ— ä»»ä½•åé¦ˆ</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>   <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>rejectedExecution</span><span style=color:#f92672>(</span>Runnable r<span style=color:#f92672>,</span> ThreadPoolExecutor e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>   <span style=color:#f92672>}</span>
</span></span></code></pre></div><ul><li><code>ThreadPoolExecutor.DiscardOldestPolicy</code> ä¸¢å¼ƒæœ€æ—©çš„ä»»åŠ¡ï¼Œç„¶åé‡æ–°æäº¤è¢«æ‹’ç»çš„ä»»åŠ¡</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>   <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>rejectedExecution</span><span style=color:#f92672>(</span>Runnable r<span style=color:#f92672>,</span> ThreadPoolExecutor e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> <span style=color:#f92672>(!</span>e<span style=color:#f92672>.</span><span style=color:#a6e22e>isShutdown</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>          e<span style=color:#f92672>.</span><span style=color:#a6e22e>getQueue</span><span style=color:#f92672>().</span><span style=color:#a6e22e>poll</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>          e<span style=color:#f92672>.</span><span style=color:#a6e22e>execute</span><span style=color:#f92672>(</span>r<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>   <span style=color:#f92672>}</span>
</span></span></code></pre></div><ul><li><code>ThreadPoolExecutor.CallerRunsPolicy</code> ç”±è°ƒç”¨çº¿ç¨‹æ¥æ‰§è¡Œè¯¥ä»»åŠ¡ã€‚</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>rejectedExecution</span><span style=color:#f92672>(</span>Runnable r<span style=color:#f92672>,</span> ThreadPoolExecutor e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(!</span>e<span style=color:#f92672>.</span><span style=color:#a6e22e>isShutdown</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            r<span style=color:#f92672>.</span><span style=color:#a6e22e>run</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span></code></pre></div><h2 id=çº¿ç¨‹>çº¿ç¨‹</h2><p>çº¿ç¨‹æ± ä¸ºäº†æ§åˆ¶çº¿ç¨‹ï¼Œç»´æŠ¤çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸï¼Œè®¾è®¡äº† <code>Workerçº¿ç¨‹</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span> <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Worker</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>extends</span> AbstractQueuedSynchronizer
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>implements</span> Runnable <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>final</span> Thread thread<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>  Runnable firstTask<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>  Worker<span style=color:#f92672>(</span>Runnable firstTask<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    setState<span style=color:#f92672>(-</span>1<span style=color:#f92672>);</span> <span style=color:#75715e>// inhibit interrupts until runWorker
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>firstTask</span> <span style=color:#f92672>=</span> firstTask<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>thread</span> <span style=color:#f92672>=</span> getThreadFactory<span style=color:#f92672>().</span><span style=color:#a6e22e>newThread</span><span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//....... çœç•¥ä»£ç 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h3 id=å·¥ä½œçº¿ç¨‹>å·¥ä½œçº¿ç¨‹</h3><p>ä»ä¸Šé¢çœ‹å‡ºï¼Œ<code>Worker</code> å®ç°äº†<code>Runnable</code>æ¥å£ï¼ŒæŒæœ‰<code>Thread</code>ï¼Œç”± <code>ThreadFactory</code> åˆ›å»ºå‡ºæ¥ï¼Œ</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span> <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>addWorker</span><span style=color:#f92672>(</span>Runnable firstTask<span style=color:#f92672>,</span> <span style=color:#66d9ef>boolean</span> core<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//....... çœç•¥ä»£ç 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>boolean</span> workerStarted <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>boolean</span> workerAdded <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        Worker w <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            w <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Worker<span style=color:#f92672>(</span>firstTask<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>final</span> Thread t <span style=color:#f92672>=</span> w<span style=color:#f92672>.</span><span style=color:#a6e22e>thread</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>//....... çœç•¥ä»£ç 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>finally</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(!</span> workerStarted<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>            addWorkerFailed<span style=color:#f92672>(</span>w<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> workerStarted<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span> <span style=color:#f92672>}</span>
</span></span></code></pre></div><h3 id=å·¥ä½œçº¿ç¨‹çš„å¢åŠ >å·¥ä½œçº¿ç¨‹çš„å¢åŠ </h3><p>ä»ä¸Šé¢çš„ä»£ç èƒ½çœ‹å‡ºæ¥ <code>Worker</code> çš„åˆ›å»ºï¼Œ<code>firstTask</code> å‚æ•°ä¸ä¸ºç©ºçš„æ—¶å€™ï¼Œä¼šç«‹é©¬æ‰§è¡Œï¼Œå¦‚æœ <code>firstTask</code> ä¸º <code>null</code>ï¼Œå°±å»åˆ›å»ºä¸€ä¸ªçº¿ç¨‹å»è·å– <code>workQueue</code> çš„ä»»åŠ¡å»æ‰§è¡Œ
æ‰§è¡Œçš„æµç¨‹åœ¨ <code>Worker</code> çš„ <code>run()</code> æ–¹æ³•</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Worker</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>extends</span> AbstractQueuedSynchronizer
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>implements</span> Runnable <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>//....... çœç•¥ä»£ç   
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>run</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    runWorker<span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>//....... çœç•¥ä»£ç 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h3 id=å·¥ä½œçº¿ç¨‹çš„é‡Šæ”¾-å’Œ-æ‰§è¡Œä»»åŠ¡>å·¥ä½œçº¿ç¨‹çš„é‡Šæ”¾ å’Œ æ‰§è¡Œä»»åŠ¡</h3><p>çº¿ç¨‹çš„é‡Šæ”¾å’Œ æ‰§è¡Œä»»åŠ¡éƒ½åœ¨ <code>runWorker</code> æ–¹æ³•ä¸­ï¼Œ
ä»»åŠ¡çš„è·å–:</p><ul><li>åœ¨ä¸€ä¸ª <code>While</code> å¾ªç¯ä¸­ä¸€ç›´åœ¨é€šè¿‡ <code>getTask()</code> è·å–ä»»åŠ¡</li><li><code>getTask()</code> æ–¹æ³•é˜»å¡é˜Ÿåˆ—ä¸­è·å–ä»»åŠ¡ï¼Œå¦‚æœè·å–åˆ°ï¼Œåˆ™æ‰§è¡Œä»»åŠ¡ï¼ˆåœ¨ä¹‹å‰è¿˜æ£€æŸ¥çº¿ç¨‹æ± çŠ¶æ€äº†ï¼Œå…·ä½“çœ‹æ³¨é‡Šï¼‰ï¼Œ</li><li>å¦‚æœå–åˆ° <code>null</code> åˆ™è·³å‡ºå¾ªç¯ï¼Œåˆ™è·³å‡ºå¾ªç¯ï¼Œæ‰§è¡Œ <code>processWorkerExit</code> æ–¹æ³•ï¼Œé”€æ¯çº¿ç¨‹</li></ul><p><code>runWorker</code> æ–¹æ³•</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>    <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>runWorker</span><span style=color:#f92672>(</span>Worker w<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        Thread wt <span style=color:#f92672>=</span> Thread<span style=color:#f92672>.</span><span style=color:#a6e22e>currentThread</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        Runnable task <span style=color:#f92672>=</span> w<span style=color:#f92672>.</span><span style=color:#a6e22e>firstTask</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        w<span style=color:#f92672>.</span><span style=color:#a6e22e>firstTask</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        w<span style=color:#f92672>.</span><span style=color:#a6e22e>unlock</span><span style=color:#f92672>();</span> <span style=color:#75715e>// allow interrupts
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>boolean</span> completedAbruptly <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>while</span> <span style=color:#f92672>(</span>task <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>||</span> <span style=color:#f92672>(</span>task <span style=color:#f92672>=</span> getTask<span style=color:#f92672>())</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                w<span style=color:#f92672>.</span><span style=color:#a6e22e>lock</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>                <span style=color:#75715e>// If pool is stopping, ensure thread is interrupted;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#75715e>// if not, ensure thread is not interrupted.  This
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#75715e>// requires a recheck in second case to deal with
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#75715e>// shutdownNow race while clearing interrupt
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#66d9ef>if</span> <span style=color:#f92672>((</span>runStateAtLeast<span style=color:#f92672>(</span>ctl<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(),</span> STOP<span style=color:#f92672>)</span> <span style=color:#f92672>||</span>
</span></span><span style=display:flex><span>                     <span style=color:#f92672>(</span>Thread<span style=color:#f92672>.</span><span style=color:#a6e22e>interrupted</span><span style=color:#f92672>()</span> <span style=color:#f92672>&amp;&amp;</span>
</span></span><span style=display:flex><span>                      runStateAtLeast<span style=color:#f92672>(</span>ctl<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(),</span> STOP<span style=color:#f92672>)))</span> <span style=color:#f92672>&amp;&amp;</span>
</span></span><span style=display:flex><span>                    <span style=color:#f92672>!</span>wt<span style=color:#f92672>.</span><span style=color:#a6e22e>isInterrupted</span><span style=color:#f92672>())</span>
</span></span><span style=display:flex><span>                    wt<span style=color:#f92672>.</span><span style=color:#a6e22e>interrupt</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    beforeExecute<span style=color:#f92672>(</span>wt<span style=color:#f92672>,</span> task<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                        task<span style=color:#f92672>.</span><span style=color:#a6e22e>run</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>                        afterExecute<span style=color:#f92672>(</span>task<span style=color:#f92672>,</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                    <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>Throwable ex<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                        afterExecute<span style=color:#f92672>(</span>task<span style=color:#f92672>,</span> ex<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>throw</span> ex<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>                    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span> <span style=color:#66d9ef>finally</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    task <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>                    w<span style=color:#f92672>.</span><span style=color:#a6e22e>completedTasks</span><span style=color:#f92672>++;</span>
</span></span><span style=display:flex><span>                    w<span style=color:#f92672>.</span><span style=color:#a6e22e>unlock</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            completedAbruptly <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>finally</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            processWorkerExit<span style=color:#f92672>(</span>w<span style=color:#f92672>,</span> completedAbruptly<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span></code></pre></div><h1 id=å¦‚ä½•ç›‘æ§å’Œæ”¹å˜>å¦‚ä½•ç›‘æ§å’Œæ”¹å˜</h1><p>åˆ°ç°åœ¨æˆ‘ä»¬äº†è§£äº†çº¿ç¨‹æ± çš„å®ç°æœºåˆ¶å’ŒåŸç†ã€‚æå‡ºç›‘æ§å’Œæ”¹å˜æ˜¯ä¸ºäº†å®æ—¶åœ¨çº¿ã€ç²¾ç»†åŒ–ç®¡æ§ç”Ÿäº§ç¯å¢ƒä¸‹çš„çº¿ç¨‹æ± ä»»åŠ¡ã€å¢åŠ å¯¹åº”çš„ç›‘æ§å’Œå‘Šè­¦ï¼Œåº”å¯¹çªå‘æƒ…å†µã€‚</p><p>é’ˆå¯¹å„ä¸ªåœºæ™¯ä¸‹çš„ï¼Œçº¿ç¨‹æ± çš„å‚æ•°è®¾ç½®ç›´æ¥å®šæ­»ï¼Œå…¶å®ä¸æ˜¯å®‰å…¨çš„æ–¹å¼ï¼Œä»å„ä¸ªæœºå™¨é…ç½®ã€ç¯å¢ƒé…ç½®ä¸Šã€åº”ç”¨çš„åº”å¯¹çš„æœåŠ¡è¯·æ±‚é‡ç­‰ç­‰ï¼Œè€Œä¸”çº¿ç¨‹æ± çš„æ‰§è¡Œæƒ…å†µä¹Ÿå’Œå„ä¸ªä»»åŠ¡ç±»å‹ç›¸å…³æ€§æ¯”è¾ƒå¤§ã€‚</p><p>é‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦åœ¨ è¿è¡Œæ—¶ç¯å¢ƒä¸‹ï¼Œæˆ‘æƒ³æ ¹æ®çœŸå®æƒ…å†µä¸‹å»æ›´æ”¹çº¿ç¨‹æ± çš„å‚æ•°ï¼Œä½¿å…¶å‚æ•°è®¾ç½®åˆç†ï¼Œè¿™ç§æ–¹å¼å°±æ˜¯å°†çº¿ç¨‹æ± çš„å‚æ•°åŠ¨æ€è¯ã€‚</p><p>å¦‚ä½•åŠ¨æ€åŒ–çº¿ç¨‹æ± çš„å‚æ•°å‘¢?</p><p>çº¿ç¨‹æ± çš„æ„é€ å‚æ•°æœ‰ä¸Šé¢æåˆ°çš„å¤šä¸ªï¼Œä½†æ˜¯æœ€æ ¸å¿ƒçš„è¿˜æ˜¯ <code>corePoolSize</code>ã€<code>maximumPoolSize</code> å’Œ <code>workQueue</code>ï¼Œæ‰€ä»¥è¿™å‡ ä¸ªå‚æ•°çš„é…ç½®ç›´æ¥å½±å“äº†çº¿ç¨‹æ± çš„æƒ…å†µ</p><p>æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹ <code>ThreadPoolExecutor</code> çš„ <code>set</code> <code>get</code> æ–¹æ³•</p><p><img src=/%E7%BB%86%E8%AF%B4%E7%BA%BF%E7%A8%8B%E6%B1%A0/set%E6%96%B9%E6%B3%95.png alt=setæ–¹æ³•></p><p>åŠ¨æ€åŒ–ä¿®æ”¹å‚æ•°å¯ä»¥å€ŸåŠ© <code>setæ–¹æ³•</code> ä¿®æ”¹å‡ ä¸ªæ ¸å¿ƒçš„å‚æ•°</p><p><img src=/%E7%BB%86%E8%AF%B4%E7%BA%BF%E7%A8%8B%E6%B1%A0/get%E6%96%B9%E6%B3%95.png alt=getæ–¹æ³•></p><p>ç›‘æ§æ–¹å‘ï¼Œå¯ä»¥å€ŸåŠ© <code>getæ–¹æ³•</code>è·å–çº¿ç¨‹æ± å…·ä½“çš„æ‰§è¡Œæƒ…å†µ</p><p>Ref:</p><ul><li>JDK16.0.2æºç </li><li><a href=https://en.wikipedia.org/wiki/Pool_(computer_science)>Pool_(computer_science)</a></li><li><a href=https://en.wikipedia.org/wiki/Thread_pool>çº¿ç¨‹æ± ThreadPool</a></li></ul></div></article><div class=blog-post-comments><div id=disqus_thread><script type=text/javascript>(function(){var t,e=document.createElement("script");e.type="text/javascript",e.async=!0,t="pinkhello",e.src="//"+t+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com/ class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></div><div id=footer-post-container><div id=footer-post><div id=nav-footer style=display:none><ul><li><a href=/>Home</a></li><li><a href=/posts>Posts</a></li><li><a href=/categories>Category</a></li><li><a href=/tags>Tag</a></li><li><a href=/index.xml>Rss</a></li><li><a href=/jobs>Job</a></li></ul></div><div id=share-footer style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fpinkhello.cc%2fposts%2f47-%25E7%25BB%2586%25E8%25B0%2588%25E7%25BA%25BF%25E7%25A8%258B%25E6%25B1%25A0%25E8%25AE%25BE%25E8%25AE%25A1%25E4%25B8%258E%25E7%259B%2591%25E6%258E%25A7%2f" aria-label=Facebook><i class="fab fa-facebook fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2fpinkhello.cc%2fposts%2f47-%25E7%25BB%2586%25E8%25B0%2588%25E7%25BA%25BF%25E7%25A8%258B%25E6%25B1%25A0%25E8%25AE%25BE%25E8%25AE%25A1%25E4%25B8%258E%25E7%259B%2591%25E6%258E%25A7%2f&text=%e7%bb%86%e8%b0%88%e7%ba%bf%e7%a8%8b%e6%b1%a0%e8%ae%be%e8%ae%a1%e4%b8%8e%e7%9b%91%e6%8e%a7" aria-label=Twitter><i class="fab fa-twitter fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fpinkhello.cc%2fposts%2f47-%25E7%25BB%2586%25E8%25B0%2588%25E7%25BA%25BF%25E7%25A8%258B%25E6%25B1%25A0%25E8%25AE%25BE%25E8%25AE%25A1%25E4%25B8%258E%25E7%259B%2591%25E6%258E%25A7%2f&title=%e7%bb%86%e8%b0%88%e7%ba%bf%e7%a8%8b%e6%b1%a0%e8%ae%be%e8%ae%a1%e4%b8%8e%e7%9b%91%e6%8e%a7" aria-label=Linkedin><i class="fab fa-linkedin fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fpinkhello.cc%2fposts%2f47-%25E7%25BB%2586%25E8%25B0%2588%25E7%25BA%25BF%25E7%25A8%258B%25E6%25B1%25A0%25E8%25AE%25BE%25E8%25AE%25A1%25E4%25B8%258E%25E7%259B%2591%25E6%258E%25A7%2f&is_video=false&description=%e7%bb%86%e8%b0%88%e7%ba%bf%e7%a8%8b%e6%b1%a0%e8%ae%be%e8%ae%a1%e4%b8%8e%e7%9b%91%e6%8e%a7" aria-label=Pinterest><i class="fab fa-pinterest fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=%e7%bb%86%e8%b0%88%e7%ba%bf%e7%a8%8b%e6%b1%a0%e8%ae%be%e8%ae%a1%e4%b8%8e%e7%9b%91%e6%8e%a7&body=Check out this article: https%3a%2f%2fpinkhello.cc%2fposts%2f47-%25E7%25BB%2586%25E8%25B0%2588%25E7%25BA%25BF%25E7%25A8%258B%25E6%25B1%25A0%25E8%25AE%25BE%25E8%25AE%25A1%25E4%25B8%258E%25E7%259B%2591%25E6%258E%25A7%2f" aria-label=Email><i class="fas fa-envelope fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fpinkhello.cc%2fposts%2f47-%25E7%25BB%2586%25E8%25B0%2588%25E7%25BA%25BF%25E7%25A8%258B%25E6%25B1%25A0%25E8%25AE%25BE%25E8%25AE%25A1%25E4%25B8%258E%25E7%259B%2591%25E6%258E%25A7%2f&title=%e7%bb%86%e8%b0%88%e7%ba%bf%e7%a8%8b%e6%b1%a0%e8%ae%be%e8%ae%a1%e4%b8%8e%e7%9b%91%e6%8e%a7" aria-label=Pocket><i class="fab fa-get-pocket fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fpinkhello.cc%2fposts%2f47-%25E7%25BB%2586%25E8%25B0%2588%25E7%25BA%25BF%25E7%25A8%258B%25E6%25B1%25A0%25E8%25AE%25BE%25E8%25AE%25A1%25E4%25B8%258E%25E7%259B%2591%25E6%258E%25A7%2f&title=%e7%bb%86%e8%b0%88%e7%ba%bf%e7%a8%8b%e6%b1%a0%e8%ae%be%e8%ae%a1%e4%b8%8e%e7%9b%91%e6%8e%a7" aria-label=reddit><i class="fab fa-reddit fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fpinkhello.cc%2fposts%2f47-%25E7%25BB%2586%25E8%25B0%2588%25E7%25BA%25BF%25E7%25A8%258B%25E6%25B1%25A0%25E8%25AE%25BE%25E8%25AE%25A1%25E4%25B8%258E%25E7%259B%2591%25E6%258E%25A7%2f&name=%e7%bb%86%e8%b0%88%e7%ba%bf%e7%a8%8b%e6%b1%a0%e8%ae%be%e8%ae%a1%e4%b8%8e%e7%9b%91%e6%8e%a7&description=%e5%89%8d%e8%a8%80%20%e4%b8%87%e5%b9%b4%e5%85%ab%e8%82%a1%e6%96%87%ef%bc%8c%e5%9c%a8%e5%b7%a5%e4%bd%9c%e4%b8%ad%e8%82%af%e5%ae%9a%e5%a4%9a%e5%a4%9a%e5%b0%91%e5%b0%91%e9%83%bd%e4%bd%bf%e7%94%a8%e4%ba%86%e7%ba%bf%e7%a8%8b%e6%b1%a0%ef%bc%8c%e4%bd%86%e6%9c%89%e6%b2%a1%e6%9c%89%e7%9c%9f%e6%ad%a3%e7%9a%84%e5%8e%bb%e4%ba%86%e8%a7%a3%e7%ba%bf%e7%a8%8b%e6%b1%a0%e7%9a%84%e6%95%b4%e4%b8%aa%e8%bf%90%e8%a1%8c%e6%9c%ba%e5%88%b6%e5%92%8c%e6%a0%b8%e5%bf%83%e5%85%b3%e9%94%ae%e7%82%b9%e3%80%82%e4%bb%8a%e5%a4%a9%e5%88%86%e4%ba%ab%e4%b8%80%e4%b8%8b%e3%80%82%0a%e7%ba%bf%e7%a8%8b%e6%b1%a0%e7%ae%80%e4%bb%8b%20%e5%85%88%e8%af%b4%20%e7%ba%bf%e7%a8%8b%28Thread%29%20%2c%20%e5%9c%a8%20Wiki%20%e7%9a%84%e8%a7%a3%e9%87%8a%e6%98%af%e6%93%8d%e4%bd%9c%e7%b3%bb%e7%bb%9f%e8%83%bd%e8%bf%9b%e8%a1%8c%e8%bf%90%e7%ae%97%e8%b0%83%e5%ba%a6%e7%9a%84%e6%9c%80%e5%b0%8f%e5%8d%95%e5%85%83%e3%80%82%e5%8c%85%e5%90%ab%e5%9c%a8%e8%bf%9b%e7%a8%8b%e4%b8%ad%ef%bc%8c%e6%98%af%e8%bf%9b%e7%a8%8b%e5%ae%9e%e9%99%85%e8%bf%90%e4%bd%9c%e7%9a%84%e5%8d%95%e5%85%83%e3%80%82%20OK%ef%bc%8c%e5%85%88%e8%ae%b0%e4%bd%8f%e8%bf%99%e4%b8%80%e7%82%b9%ef%bc%8c%e6%88%91%e4%bb%ac%e8%af%b4%20%e7%ba%bf%e7%a8%8b%e6%b1%a0%28Thread%20Pool%29%20%ef%bc%8c%e9%a1%be%e5%90%8d%e6%80%9d%e4%b9%89%ef%bc%8c%e5%9f%ba%e4%ba%8e%e6%b1%a0%e5%8c%96%e6%80%9d%e6%83%b3%e7%9a%84%e7%ae%a1%e7%90%86%e7%ba%bf%e7%a8%8b%e7%9a%84%e6%89%8b%e6%ae%b5%ef%bc%88%e5%b7%a5%e5%85%b7%ef%bc%89%e3%80%82%e6%97%a2%e7%84%b6%e5%8f%ab%e7%ba%bf%e7%a8%8b%e6%b1%a0%e4%ba%86%ef%bc%8c%e5%8f%af%e4%bb%a5%20%e7%9f%a5%e9%81%93%e8%82%af%e5%ae%9a%e6%98%af%e5%a4%9a%e7%ba%bf%e7%a8%8b%e7%9a%84%e6%9c%8d%e5%8a%a1%e7%8e%af%e5%a2%83%e4%b8%8b%e3%80%82%0a%e6%88%91%e4%bb%ac%e9%83%bd%e7%9f%a5%e9%81%93Server%e7%9a%84%e8%b5%84%e6%ba%90%e6%98%af%e6%9c%89%e9%99%90%e7%9a%84%ef%bc%8c%e4%b8%8d%e5%8f%af%e8%83%bd%e6%97%a0%e6%ad%a2%e5%a2%83%e7%9a%84%e6%89%a9%e5%bc%a0%ef%bc%88%e4%bb%8e%e6%88%90%e6%9c%ac%e3%80%81%e8%bf%90%e7%bb%b4%e4%b8%8a%e8%80%83%e8%99%91%ef%bc%89%e3%80%82%e7%ba%bf%e7%a8%8b%e8%bf%87%e5%88%86%e7%9a%84%e5%bc%80%e8%be%9f%e7%9a%84%e8%af%9d%ef%bc%8c%e4%bc%9a%e5%af%bc%e8%87%b4%e6%95%b4%e4%bd%93%e6%9c%8d%e5%8a%a1%e5%99%a8%e8%b5%84%e6%ba%90%e5%90%83%e7%b4%a7%ef%bc%88%e7%ba%bf%e7%a8%8b%e5%b8%a6%e6%9d%a5%e7%9a%84%e5%bc%80%e9%94%80%e3%80%81%e5%88%9b%e5%bb%ba%e3%80%81%e8%b0%83%e5%ba%a6%e7%ad%89%e7%ad%89%ef%bc%89%e3%80%82%20%e6%b1%a0%e5%8c%96%e7%9a%84%e6%80%9d%e6%83%b3%ef%bc%8c%e7%ba%bf%e7%a8%8b%e6%b1%a0%e7%bb%b4%e6%8a%a4%e7%9d%80%e5%a4%9a%e4%b8%aa%e7%ba%bf%e7%a8%8b%ef%bc%8c%e7%ad%89%e5%be%85%e8%b0%83%e5%ba%a6%e5%88%86%e9%85%8d%e5%b9%b6%e5%8f%91%e4%bb%bb%e5%8a%a1%e5%8e%bb%e6%89%a7%e8%a1%8c%e3%80%82%e4%b8%80%e6%96%b9%e9%9d%a2%e9%81%bf%e5%85%8d%e6%9c%89%e4%bb%bb%e5%8a%a1%e5%b0%b1%e5%88%9b%e5%bb%ba%e7%ba%bf%e7%a8%8b%e5%b8%a6%e6%9d%a5%e7%9a%84%e9%a2%9d%e5%a4%96%e7%9a%84%e5%bc%80%e9%94%80%ef%bc%8c%e5%8f%a6%e4%b8%80%e6%96%b9%e9%9d%a2%e4%b9%9f%e6%98%af%e4%bf%9d%e6%8a%a4%e6%9c%8d%e5%8a%a1%e5%99%a8%e4%ba%a7%e7%94%9f%e8%bf%87%e5%a4%9a%e7%9a%84%e7%ba%bf%e7%a8%8b%e6%95%b0%e9%87%8f%e3%80%82%0a%e7%ba%bf%e7%a8%8b%e6%b1%a0%e8%a7%a3%e5%86%b3%e4%bb%80%e4%b9%88%e9%97%ae%e9%a2%98%20%e7%ba%bf%e7%a8%8b%e6%b1%a0%e8%a7%a3%e5%86%b3%e7%9a%84%e6%a0%b8%e5%bf%83%e9%97%ae%e9%a2%98%e6%98%af%e8%b5%84%e6%ba%90%e7%ae%a1%e7%90%86%e9%97%ae%e9%a2%98%ef%bc%8c%e5%9c%a8%e5%b9%b6%e5%8f%91%e7%8e%af%e5%a2%83%e4%b8%8b%ef%bc%8c%e7%b3%bb%e7%bb%9f%e5%92%8c%e6%9c%8d%e5%8a%a1%e5%b9%b6%e4%b8%8d%e7%9f%a5%e9%81%93%e5%9c%a8%e4%bb%80%e4%b9%88%e6%97%b6%e5%80%99%e9%9c%80%e8%a6%81%e5%a4%9a%e5%b0%91%e8%b5%84%e6%ba%90%e3%80%82%e8%80%8c%20%e6%b1%a0%e5%8c%96%28Pooling%29%20%e6%80%9d%e6%83%b3%ef%bc%8c%e5%b0%b1%e6%98%af%e4%b8%ba%e4%ba%86%e5%b0%86%e8%b5%84%e6%ba%90%e7%bb%9f%e4%b8%80%e7%ae%a1%e7%90%86%e7%9a%84%e6%83%85%e5%86%b5%e4%b8%8b%ef%bc%8c%e5%87%8f%e5%b0%8f%e9%a3%8e%e9%99%a9%e7%9a%84%e6%80%9d%e6%83%b3%e3%80%82%0aWiki%e4%b8%8a%20ThreadPool%e5%9b%be%0aP.S%20%3a%20%e6%b1%a0%e5%8c%96%e6%80%9d%e6%83%b3%e4%b8%be%e4%be%8b%0a%e5%86%85%e5%ad%98%e6%b1%a0%28Memory%20Pool%29%20%e5%af%b9%e8%b1%a1%e6%b1%a0%28Object%20Pool%29%20%e5%8d%b3%e5%ae%9e%e4%be%8b%e6%b1%a0%20%e8%bf%9e%e6%8e%a5%e6%b1%a0%28Connection%20Pool%29%20%e7%ba%bf%e7%a8%8b%e6%b1%a0%e6%a0%b8%e5%bf%83%e8%ae%be%e8%ae%a1%20%e5%9c%a8%e7%9c%8b%e7%ba%bf%e7%a8%8b%e6%b1%a0%e7%9a%84%e8%ae%be%e8%ae%a1%e4%b9%8b%e5%89%8d%ef%bc%8c%e5%85%88%e4%ba%86%e8%a7%a3%e4%b8%80%e4%b8%8b%e7%ba%bf%e7%a8%8b%e6%b1%a0%e7%9a%84%e6%9e%84%e9%80%a0%e5%8f%82%e6%95%b0%0acorePoolSize%20%e2%80%93%20the%20number%20of%20threads%20to%20keep%20in%20the%20pool%2c%20even%20if%20they%20are%20idle%2c%20unless%20allowCoreThreadTimeOut%20is%20set%20maximumPoolSize%20%e2%80%93%20the%20maximum%20number%20of%20threads%20to%20allow%20in%20the%20pool%20keepAliveTime%20%e2%80%93%20when%20the%20number%20of%20threads%20is%20greater%20than%20the%20core%2c%20this%20is%20the%20maximum%20time%20that%20excess%20idle%20threads%20will%20wait%20for%20new%20tasks%20before%20terminating." aria-label=Tumblr><i class="fab fa-tumblr fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fpinkhello.cc%2fposts%2f47-%25E7%25BB%2586%25E8%25B0%2588%25E7%25BA%25BF%25E7%25A8%258B%25E6%25B1%25A0%25E8%25AE%25BE%25E8%25AE%25A1%25E4%25B8%258E%25E7%259B%2591%25E6%258E%25A7%2f&t=%e7%bb%86%e8%b0%88%e7%ba%bf%e7%a8%8b%e6%b1%a0%e8%ae%be%e8%ae%a1%e4%b8%8e%e7%9b%91%e6%8e%a7" aria-label="Hacker News"><i class="fab fa-hacker-news fa-lg" aria-hidden=true></i></a></li></ul></div><div id=actions-footer><a id=menu-toggle class=icon href=# onclick='return $("#nav-footer").toggle(),!1' aria-label=Menu><i class="fas fa-bars fa-lg" aria-hidden=true></i> Menu</a>
<a id=share-toggle class=icon href=# onclick='return $("#share-footer").toggle(),!1' aria-label=Share><i class="fas fa-share-alt fa-lg" aria-hidden=true></i> share</a>
<a id=top style=display:none class=icon href=# onclick='$("html, body").animate({scrollTop:0},"fast")' aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg" aria-hidden=true></i> Top</a></div></div></div><footer id=footer><div class=footer-left>Copyright &copy; 2022 pinkhello</div><div class=footer-right><nav><ul><li><a href=/>Home</a></li><li><a href=/posts>Posts</a></li><li><a href=/categories>Category</a></li><li><a href=/tags>Tag</a></li><li><a href=/index.xml>Rss</a></li><li><a href=/jobs>Job</a></li></ul></nav></div></footer></div></body><link rel=stylesheet href=/lib/font-awesome/css/all.min.css><script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>
<script src=/js/code-copy.js></script>
<script>MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]]},svg:{fontCache:"global"}}</script><script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script></html>