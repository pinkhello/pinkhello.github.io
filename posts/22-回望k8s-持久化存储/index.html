<!doctype html><html lang=en-us><head><link rel=preload href=/lib/font-awesome/webfonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous><script type=text/javascript src=https://latest.cactus.chat/cactus.js></script>
<link rel=stylesheet href=https://latest.cactus.chat/style.css type=text/css><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>å›æœ›K8S æŒä¹…åŒ–å­˜å‚¨ | pinkhello</title><link rel=canonical href=https://pinkhello.cc/posts/22-%E5%9B%9E%E6%9C%9Bk8s-%E6%8C%81%E4%B9%85%E5%8C%96%E5%AD%98%E5%82%A8/><meta name=description content="ğŸ‘·Hey! æˆ‘æ˜¯ **pinkhello**ï¼ŒğŸ’» ä¸€ååç«¯ç¨‹åºå‘˜ã€‚**é‡è¦æç¤º**: åœ¨æ‚¨é˜…è¯»æ–‡ç« å¹¶è¯„è®ºä¹‹å‰ï¼Œè¯·å…ˆè®¤çœŸé˜…è¯»[**è¯„è®ºæ‰¿è¯º**](http://pinkhello.cc/promise)ã€‚"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta property="og:title" content="å›æœ›K8S æŒä¹…åŒ–å­˜å‚¨"><meta property="og:description" content="PVã€PVCã€StorageClass è¯´çš„å•¥ï¼Ÿ PV: æŒä¹…åŒ–å­˜å‚¨æ•°æ®å·ï¼Œè¿™ä¸ª API ä¸»è¦å®šä¹‰çš„æ˜¯ä¸€ä¸ªæŒä¹…åŒ–å­˜å‚¨åœ¨å®¿ä¸»æœºä¸Šçš„ä¸€ä¸ªç›®å½•ã€‚ä¸€èˆ¬ç”±è¿ç»´äººå‘˜è¿›è¡Œå®šä¹‰ï¼Œæ¯”å¦‚å®šä¹‰ä¸€ä¸ª NFS ç±»å‹çš„ PV
apiVersion: v1 kind: PersistentVolume metadata: name: nfs spec: storageClassName: manual capacity: storage: 1Gi accessModes: - ReadWriteMany nfs: server: 10.244.1.5 path: &#34;/&#34; PVC: POD æ‰€å¸Œæœ›ä½¿ç”¨çš„æŒä¹…åŒ–å­˜å‚¨çš„å±æ€§. æ¯”å¦‚ Volume çš„å­˜å‚¨å¤§å°ã€å¯è¯»å†™æƒé™ç­‰. PVC ä¸€èˆ¬ç”±å¼€å‘äººå‘˜åˆ›å»ºã€æˆ–è€…ç”± PVCæ¨¡æ¿çš„æ–¹å¼æˆä¸ºStatefulSetçš„ä¸€éƒ¨åˆ†ï¼Œç”±StatefulSetæ§åˆ¶å™¨è´Ÿè´£åˆ›å»ºå¸¦ç¼–å·çš„PVC.
# åˆ›å»ºä¸€ä¸ª 1 GB å¤§å°çš„PVC --- apiVersion: v1 kind: PersistentVolumeClaim metadata: name: nfs spec: accessModes: - ReadWriteMany storageClassName: manual resources: requests: storage: 1Gi ... ç”¨æˆ·åˆ›å»ºçš„PVCè¦çœŸæ­£çš„è¢«å®¹å™¨ä½¿ç”¨çš„åŒ–ï¼Œéœ€è¦äºå¿ƒå’ŒæŸä¸ªç¬¦åˆæ¡ä»¶çš„PVè¿›è¡Œç»‘å®šï¼š
ç¬¬ä¸€ä¸ªæ¡ä»¶ï¼ŒPV å’Œ PVC çš„ spec å­—æ®µã€‚ä¾‹å¦‚: PV çš„å­˜å‚¨(storage)å¤§å°å°±å¿…é¡»æ»¡è¶³ PVC çš„è¦æ±‚ ç¬¬äºŒä¸ªæ¡ä»¶ï¼ŒPV å’Œ PVC çš„ storageClassName å­—æ®µåç§°å¿…é¡»ä¸€æ ·ã€‚ ä¸‹é¢æ˜¯å»ä½¿ç”¨è¿™ä¸ªPVC"><meta property="og:type" content="article"><meta property="og:url" content="https://pinkhello.cc/posts/22-%E5%9B%9E%E6%9C%9Bk8s-%E6%8C%81%E4%B9%85%E5%8C%96%E5%AD%98%E5%82%A8/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-05-18T08:00:00+08:00"><meta property="article:modified_time" content="2021-05-18T08:00:00+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="å›æœ›K8S æŒä¹…åŒ–å­˜å‚¨"><meta name=twitter:description content="PVã€PVCã€StorageClass è¯´çš„å•¥ï¼Ÿ PV: æŒä¹…åŒ–å­˜å‚¨æ•°æ®å·ï¼Œè¿™ä¸ª API ä¸»è¦å®šä¹‰çš„æ˜¯ä¸€ä¸ªæŒä¹…åŒ–å­˜å‚¨åœ¨å®¿ä¸»æœºä¸Šçš„ä¸€ä¸ªç›®å½•ã€‚ä¸€èˆ¬ç”±è¿ç»´äººå‘˜è¿›è¡Œå®šä¹‰ï¼Œæ¯”å¦‚å®šä¹‰ä¸€ä¸ª NFS ç±»å‹çš„ PV
apiVersion: v1 kind: PersistentVolume metadata: name: nfs spec: storageClassName: manual capacity: storage: 1Gi accessModes: - ReadWriteMany nfs: server: 10.244.1.5 path: &#34;/&#34; PVC: POD æ‰€å¸Œæœ›ä½¿ç”¨çš„æŒä¹…åŒ–å­˜å‚¨çš„å±æ€§. æ¯”å¦‚ Volume çš„å­˜å‚¨å¤§å°ã€å¯è¯»å†™æƒé™ç­‰. PVC ä¸€èˆ¬ç”±å¼€å‘äººå‘˜åˆ›å»ºã€æˆ–è€…ç”± PVCæ¨¡æ¿çš„æ–¹å¼æˆä¸ºStatefulSetçš„ä¸€éƒ¨åˆ†ï¼Œç”±StatefulSetæ§åˆ¶å™¨è´Ÿè´£åˆ›å»ºå¸¦ç¼–å·çš„PVC.
# åˆ›å»ºä¸€ä¸ª 1 GB å¤§å°çš„PVC --- apiVersion: v1 kind: PersistentVolumeClaim metadata: name: nfs spec: accessModes: - ReadWriteMany storageClassName: manual resources: requests: storage: 1Gi ... ç”¨æˆ·åˆ›å»ºçš„PVCè¦çœŸæ­£çš„è¢«å®¹å™¨ä½¿ç”¨çš„åŒ–ï¼Œéœ€è¦äºå¿ƒå’ŒæŸä¸ªç¬¦åˆæ¡ä»¶çš„PVè¿›è¡Œç»‘å®šï¼š
ç¬¬ä¸€ä¸ªæ¡ä»¶ï¼ŒPV å’Œ PVC çš„ spec å­—æ®µã€‚ä¾‹å¦‚: PV çš„å­˜å‚¨(storage)å¤§å°å°±å¿…é¡»æ»¡è¶³ PVC çš„è¦æ±‚ ç¬¬äºŒä¸ªæ¡ä»¶ï¼ŒPV å’Œ PVC çš„ storageClassName å­—æ®µåç§°å¿…é¡»ä¸€æ ·ã€‚ ä¸‹é¢æ˜¯å»ä½¿ç”¨è¿™ä¸ªPVC"><link rel=stylesheet href=https://pinkhello.cc/css/styles.94f653e9e151e28067a7c5dbbc4600cbd5a3c721e79faaf971e523c40f3b249b8e4f20bb57810dfffa8d559ca5c140fd56eb4cd9c0853113ad08e66afdb08bdd.css integrity="sha512-lPZT6eFR4oBnp8XbvEYAy9WjxyHnn6r5ceUjxA87JJuOTyC7V4EN//qNVZylwUD9VutM2cCFMROtCOZq/bCL3Q=="><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script>
<script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=icon type=image/png href=https://pinkhello.cc/images/favicon.ico><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-M2FXWC325L","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body class="max-width mx-auto px3 ltr"><div class="content index py4"><div id=header-post><a id=menu-icon href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=menu-icon-tablet href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=top-icon-tablet href=# onclick='$("html, body").animate({scrollTop:0},"fast")' style=display:none aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
<span id=menu><span id=nav><ul><li><a href=/>Home</a></li><li><a href=/posts>Posts</a></li><li><a href=/categories>Category</a></li><li><a href=/tags>Tag</a></li><li><a href=/index.xml>Rss</a></li><li><a href=/jobs>Job</a></li></ul></span><br><span id=actions><ul><li><a class=icon href=https://pinkhello.cc/posts/20-%E5%9B%9E%E6%9C%9Bk8s-%E5%AE%B9%E5%99%A8%E7%BC%96%E6%8E%92%E4%B8%8Ekubernetes%E4%BD%9C%E4%B8%9A%E7%AE%A1%E7%90%86/ aria-label=Previous><i class="fas fa-chevron-left" aria-hidden=true onmouseover='$("#i-prev").toggle()' onmouseout='$("#i-prev").toggle()'></i></a></li><li><a class=icon href=https://pinkhello.cc/posts/24-rocketmq%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB-%E5%BC%80%E7%AF%87/ aria-label=Next><i class="fas fa-chevron-right" aria-hidden=true onmouseover='$("#i-next").toggle()' onmouseout='$("#i-next").toggle()'></i></a></li><li><a class=icon href=# onclick='$("html, body").animate({scrollTop:0},"fast")' aria-label="Top of Page"><i class="fas fa-chevron-up" aria-hidden=true onmouseover='$("#i-top").toggle()' onmouseout='$("#i-top").toggle()'></i></a></li><li><a class=icon href=# aria-label=Share><i class="fas fa-share-alt" aria-hidden=true onmouseover='$("#i-share").toggle()' onmouseout='$("#i-share").toggle()' onclick='return $("#share").toggle(),!1'></i></a></li></ul><span id=i-prev class=info style=display:none>Previous post</span>
<span id=i-next class=info style=display:none>Next post</span>
<span id=i-top class=info style=display:none>Back to top</span>
<span id=i-share class=info style=display:none>Share post</span></span><br><div id=share style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fpinkhello.cc%2fposts%2f22-%25E5%259B%259E%25E6%259C%259Bk8s-%25E6%258C%2581%25E4%25B9%2585%25E5%258C%2596%25E5%25AD%2598%25E5%2582%25A8%2f" aria-label=Facebook><i class="fab fa-facebook" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2fpinkhello.cc%2fposts%2f22-%25E5%259B%259E%25E6%259C%259Bk8s-%25E6%258C%2581%25E4%25B9%2585%25E5%258C%2596%25E5%25AD%2598%25E5%2582%25A8%2f&text=%e5%9b%9e%e6%9c%9bK8S%20%e6%8c%81%e4%b9%85%e5%8c%96%e5%ad%98%e5%82%a8" aria-label=Twitter><i class="fab fa-twitter" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fpinkhello.cc%2fposts%2f22-%25E5%259B%259E%25E6%259C%259Bk8s-%25E6%258C%2581%25E4%25B9%2585%25E5%258C%2596%25E5%25AD%2598%25E5%2582%25A8%2f&title=%e5%9b%9e%e6%9c%9bK8S%20%e6%8c%81%e4%b9%85%e5%8c%96%e5%ad%98%e5%82%a8" aria-label=Linkedin><i class="fab fa-linkedin" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fpinkhello.cc%2fposts%2f22-%25E5%259B%259E%25E6%259C%259Bk8s-%25E6%258C%2581%25E4%25B9%2585%25E5%258C%2596%25E5%25AD%2598%25E5%2582%25A8%2f&is_video=false&description=%e5%9b%9e%e6%9c%9bK8S%20%e6%8c%81%e4%b9%85%e5%8c%96%e5%ad%98%e5%82%a8" aria-label=Pinterest><i class="fab fa-pinterest" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=%e5%9b%9e%e6%9c%9bK8S%20%e6%8c%81%e4%b9%85%e5%8c%96%e5%ad%98%e5%82%a8&body=Check out this article: https%3a%2f%2fpinkhello.cc%2fposts%2f22-%25E5%259B%259E%25E6%259C%259Bk8s-%25E6%258C%2581%25E4%25B9%2585%25E5%258C%2596%25E5%25AD%2598%25E5%2582%25A8%2f" aria-label=Email><i class="fas fa-envelope" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fpinkhello.cc%2fposts%2f22-%25E5%259B%259E%25E6%259C%259Bk8s-%25E6%258C%2581%25E4%25B9%2585%25E5%258C%2596%25E5%25AD%2598%25E5%2582%25A8%2f&title=%e5%9b%9e%e6%9c%9bK8S%20%e6%8c%81%e4%b9%85%e5%8c%96%e5%ad%98%e5%82%a8" aria-label=Pocket><i class="fab fa-get-pocket" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fpinkhello.cc%2fposts%2f22-%25E5%259B%259E%25E6%259C%259Bk8s-%25E6%258C%2581%25E4%25B9%2585%25E5%258C%2596%25E5%25AD%2598%25E5%2582%25A8%2f&title=%e5%9b%9e%e6%9c%9bK8S%20%e6%8c%81%e4%b9%85%e5%8c%96%e5%ad%98%e5%82%a8" aria-label=reddit><i class="fab fa-reddit" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fpinkhello.cc%2fposts%2f22-%25E5%259B%259E%25E6%259C%259Bk8s-%25E6%258C%2581%25E4%25B9%2585%25E5%258C%2596%25E5%25AD%2598%25E5%2582%25A8%2f&name=%e5%9b%9e%e6%9c%9bK8S%20%e6%8c%81%e4%b9%85%e5%8c%96%e5%ad%98%e5%82%a8&description=PV%e3%80%81PVC%e3%80%81StorageClass%20%e8%af%b4%e7%9a%84%e5%95%a5%ef%bc%9f%20PV%3a%20%e6%8c%81%e4%b9%85%e5%8c%96%e5%ad%98%e5%82%a8%e6%95%b0%e6%8d%ae%e5%8d%b7%ef%bc%8c%e8%bf%99%e4%b8%aa%20API%20%e4%b8%bb%e8%a6%81%e5%ae%9a%e4%b9%89%e7%9a%84%e6%98%af%e4%b8%80%e4%b8%aa%e6%8c%81%e4%b9%85%e5%8c%96%e5%ad%98%e5%82%a8%e5%9c%a8%e5%ae%bf%e4%b8%bb%e6%9c%ba%e4%b8%8a%e7%9a%84%e4%b8%80%e4%b8%aa%e7%9b%ae%e5%bd%95%e3%80%82%e4%b8%80%e8%88%ac%e7%94%b1%e8%bf%90%e7%bb%b4%e4%ba%ba%e5%91%98%e8%bf%9b%e8%a1%8c%e5%ae%9a%e4%b9%89%ef%bc%8c%e6%af%94%e5%a6%82%e5%ae%9a%e4%b9%89%e4%b8%80%e4%b8%aa%20NFS%20%e7%b1%bb%e5%9e%8b%e7%9a%84%20PV%0aapiVersion%3a%20v1%20kind%3a%20PersistentVolume%20metadata%3a%20name%3a%20nfs%20spec%3a%20storageClassName%3a%20manual%20capacity%3a%20storage%3a%201Gi%20accessModes%3a%20-%20ReadWriteMany%20nfs%3a%20server%3a%2010.244.1.5%20path%3a%20%26%2334%3b%2f%26%2334%3b%20PVC%3a%20POD%20%e6%89%80%e5%b8%8c%e6%9c%9b%e4%bd%bf%e7%94%a8%e7%9a%84%e6%8c%81%e4%b9%85%e5%8c%96%e5%ad%98%e5%82%a8%e7%9a%84%e5%b1%9e%e6%80%a7.%20%e6%af%94%e5%a6%82%20Volume%20%e7%9a%84%e5%ad%98%e5%82%a8%e5%a4%a7%e5%b0%8f%e3%80%81%e5%8f%af%e8%af%bb%e5%86%99%e6%9d%83%e9%99%90%e7%ad%89.%20PVC%20%e4%b8%80%e8%88%ac%e7%94%b1%e5%bc%80%e5%8f%91%e4%ba%ba%e5%91%98%e5%88%9b%e5%bb%ba%e3%80%81%e6%88%96%e8%80%85%e7%94%b1%20PVC%e6%a8%a1%e6%9d%bf%e7%9a%84%e6%96%b9%e5%bc%8f%e6%88%90%e4%b8%baStatefulSet%e7%9a%84%e4%b8%80%e9%83%a8%e5%88%86%ef%bc%8c%e7%94%b1StatefulSet%e6%8e%a7%e5%88%b6%e5%99%a8%e8%b4%9f%e8%b4%a3%e5%88%9b%e5%bb%ba%e5%b8%a6%e7%bc%96%e5%8f%b7%e7%9a%84PVC.%0a%23%20%e5%88%9b%e5%bb%ba%e4%b8%80%e4%b8%aa%201%20GB%20%e5%a4%a7%e5%b0%8f%e7%9a%84PVC%20---%20apiVersion%3a%20v1%20kind%3a%20PersistentVolumeClaim%20metadata%3a%20name%3a%20nfs%20spec%3a%20accessModes%3a%20-%20ReadWriteMany%20storageClassName%3a%20manual%20resources%3a%20requests%3a%20storage%3a%201Gi%20...%20%e7%94%a8%e6%88%b7%e5%88%9b%e5%bb%ba%e7%9a%84PVC%e8%a6%81%e7%9c%9f%e6%ad%a3%e7%9a%84%e8%a2%ab%e5%ae%b9%e5%99%a8%e4%bd%bf%e7%94%a8%e7%9a%84%e5%8c%96%ef%bc%8c%e9%9c%80%e8%a6%81%e4%ba%8e%e5%bf%83%e5%92%8c%e6%9f%90%e4%b8%aa%e7%ac%a6%e5%90%88%e6%9d%a1%e4%bb%b6%e7%9a%84PV%e8%bf%9b%e8%a1%8c%e7%bb%91%e5%ae%9a%ef%bc%9a%0a%e7%ac%ac%e4%b8%80%e4%b8%aa%e6%9d%a1%e4%bb%b6%ef%bc%8cPV%20%e5%92%8c%20PVC%20%e7%9a%84%20spec%20%e5%ad%97%e6%ae%b5%e3%80%82%e4%be%8b%e5%a6%82%3a%20PV%20%e7%9a%84%e5%ad%98%e5%82%a8%28storage%29%e5%a4%a7%e5%b0%8f%e5%b0%b1%e5%bf%85%e9%a1%bb%e6%bb%a1%e8%b6%b3%20PVC%20%e7%9a%84%e8%a6%81%e6%b1%82%20%e7%ac%ac%e4%ba%8c%e4%b8%aa%e6%9d%a1%e4%bb%b6%ef%bc%8cPV%20%e5%92%8c%20PVC%20%e7%9a%84%20storageClassName%20%e5%ad%97%e6%ae%b5%e5%90%8d%e7%a7%b0%e5%bf%85%e9%a1%bb%e4%b8%80%e6%a0%b7%e3%80%82%20%e4%b8%8b%e9%9d%a2%e6%98%af%e5%8e%bb%e4%bd%bf%e7%94%a8%e8%bf%99%e4%b8%aaPVC" aria-label=Tumblr><i class="fab fa-tumblr" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fpinkhello.cc%2fposts%2f22-%25E5%259B%259E%25E6%259C%259Bk8s-%25E6%258C%2581%25E4%25B9%2585%25E5%258C%2596%25E5%25AD%2598%25E5%2582%25A8%2f&t=%e5%9b%9e%e6%9c%9bK8S%20%e6%8c%81%e4%b9%85%e5%8c%96%e5%ad%98%e5%82%a8" aria-label="Hacker News"><i class="fab fa-hacker-news" aria-hidden=true></i></a></li></ul></div></span></div><article class=post itemscope itemtype=http://schema.org/BlogPosting><header><h1 class=posttitle itemprop="name headline">å›æœ›K8S æŒä¹…åŒ–å­˜å‚¨</h1><div class=meta><div class=postdate><time datetime="2021-05-18 08:00:00 +0800 +0800" itemprop=datePublished>2021-05-18</time></div><div class=article-category><i class="fas fa-archive"></i>
<a class=category-link href=/categories/tech>Tech</a></div><div class=article-tag><i class="fas fa-tag"></i>
<a class=tag-link href=/tags/k8s rel=tag>k8s</a></div></div></header><div id=toc><nav id=TableOfContents></nav></div><div class=content itemprop=articleBody><h1 id=pvpvcstorageclass-è¯´çš„å•¥><code>PV</code>ã€<code>PVC</code>ã€<code>StorageClass</code> è¯´çš„å•¥ï¼Ÿ</h1><p><code>PV</code>: æŒä¹…åŒ–å­˜å‚¨æ•°æ®å·ï¼Œè¿™ä¸ª API ä¸»è¦å®šä¹‰çš„æ˜¯ä¸€ä¸ªæŒä¹…åŒ–å­˜å‚¨åœ¨å®¿ä¸»æœºä¸Šçš„ä¸€ä¸ªç›®å½•ã€‚ä¸€èˆ¬ç”±è¿ç»´äººå‘˜è¿›è¡Œå®šä¹‰ï¼Œæ¯”å¦‚å®šä¹‰ä¸€ä¸ª NFS ç±»å‹çš„ PV</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>PersistentVolume</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nfs</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>storageClassName</span>: <span style=color:#ae81ff>manual</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>capacity</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>storage</span>: <span style=color:#ae81ff>1Gi</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>accessModes</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>ReadWriteMany</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>nfs</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>server</span>: <span style=color:#ae81ff>10.244.1.5</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>path</span>: <span style=color:#e6db74>&#34;/&#34;</span>
</span></span></code></pre></div><p><code>PVC</code>: POD æ‰€å¸Œæœ›ä½¿ç”¨çš„æŒä¹…åŒ–å­˜å‚¨çš„å±æ€§. æ¯”å¦‚ <code>Volume</code> çš„å­˜å‚¨å¤§å°ã€å¯è¯»å†™æƒé™ç­‰.
<code>PVC</code> ä¸€èˆ¬ç”±å¼€å‘äººå‘˜åˆ›å»ºã€æˆ–è€…ç”± <code>PVC</code>æ¨¡æ¿çš„æ–¹å¼æˆä¸º<code>StatefulSet</code>çš„ä¸€éƒ¨åˆ†ï¼Œç”±<code>StatefulSet</code>æ§åˆ¶å™¨è´Ÿè´£åˆ›å»ºå¸¦ç¼–å·çš„<code>PVC</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># åˆ›å»ºä¸€ä¸ª 1 GB å¤§å°çš„PVC</span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>PersistentVolumeClaim</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nfs</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>accessModes</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>ReadWriteMany</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>storageClassName</span>: <span style=color:#ae81ff>manual</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>resources</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>requests</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>storage</span>: <span style=color:#ae81ff>1Gi</span>
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><p>ç”¨æˆ·åˆ›å»ºçš„<code>PVC</code>è¦çœŸæ­£çš„è¢«å®¹å™¨ä½¿ç”¨çš„åŒ–ï¼Œéœ€è¦äºå¿ƒå’ŒæŸä¸ªç¬¦åˆæ¡ä»¶çš„<code>PV</code>è¿›è¡Œç»‘å®šï¼š</p><ul><li>ç¬¬ä¸€ä¸ªæ¡ä»¶ï¼Œ<code>PV</code> å’Œ <code>PVC</code> çš„ <code>spec</code> å­—æ®µã€‚ä¾‹å¦‚: <code>PV</code> çš„å­˜å‚¨(<code>storage</code>)å¤§å°å°±å¿…é¡»æ»¡è¶³ <code>PVC</code> çš„è¦æ±‚</li><li>ç¬¬äºŒä¸ªæ¡ä»¶ï¼Œ<code>PV</code> å’Œ <code>PVC</code> çš„ <code>storageClassName</code> å­—æ®µåç§°å¿…é¡»ä¸€æ ·ã€‚</li></ul><p>ä¸‹é¢æ˜¯å»ä½¿ç”¨è¿™ä¸ª<code>PVC</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Pod</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>role</span>: <span style=color:#ae81ff>web-frontend</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>web</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>nginx</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>web</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>containerPort</span>: <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumeMounts</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nfs</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>mountPath</span>: <span style=color:#e6db74>&#34;/usr/share/nginx/html&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nfs</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>persistentVolumeClaim</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>claimName</span>: <span style=color:#ae81ff>nfs</span>
</span></span></code></pre></div><p><code>PVC</code> ç†è§£ä¸ºæŒä¹…åŒ–å­˜å‚¨çš„ æ¥å£ï¼Œå®ƒæä¾›äº†å¯¹æŸç§æŒä¹…åŒ–å­˜å‚¨çš„æè¿°ï¼Œä½†ä¸æä¾›å…·ä½“çš„å®ç°ï¼Œè€Œè¿™ä¸ªæŒä¹…åŒ–çš„å®ç°éƒ¨åˆ†ç”± <code>PV</code> å®Œæˆã€‚</p><p>å‡è®¾ï¼Œæˆ‘ä»¬åœ¨åˆ›å»º <code>POD</code> çš„æ—¶å€™ï¼Œç³»ç»Ÿå†…å¹¶æ²¡æœ‰åˆé€‚çš„ <code>PV</code> è·Ÿå®ƒå®šä¹‰çš„ <code>PVC</code> ç»‘å®šï¼Œè¿™ä¸ªæ—¶å€™å®¹å™¨æƒ³è¦ä½¿ç”¨çš„ <code>Volume</code> ä¸å­˜åœ¨ï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿ</p><p>åœ¨ <code>Kubernetes</code> å†…ï¼Œæ—¶æœºå­˜åœ¨ä¸€ä¸ªä¸“é—¨å¤„ç†æŒä¹…åŒ–å­˜å‚¨çš„æ§åˆ¶å™¨ï¼Œå«åš <code>VolumeController</code>ã€‚è¿™ä¸ª<code>VolumeController</code>ç»´æŠ¤ç€å¤šä¸ªæ§åˆ¶å¾ªç¯,
å…¶ä¸­æœ‰ä¸ªå¾ªç¯å°±æ˜¯ç”¨æ¥æ’®åˆ <code>PV</code> å’Œ <code>PVC</code> è¿›è¡Œç»‘å®šçš„è§’è‰²ï¼Œåå­—å« <code>PersistentVolumeController</code>. å®ƒä¼šä¸æ–­çš„æŸ¥çœ‹å½“å‰çš„æ¯ä¸€ä¸ª <code>PVC</code>ï¼Œ æ˜¯å¦å¤„äº <code>Bound</code> çŠ¶æ€
å¦‚æœä¸æ˜¯ï¼Œå®ƒä¼šéå†æ‰€ä»¥çš„ã€å¯ç”¨çš„ <code>PV</code>ï¼Œå¹¶å°è¯•å°†å…¶ä¸è¿™ä¸ªå£°æ˜çš„PVCè¿›è¡Œç»‘å®šã€‚è¿™æ ·ï¼Œ<code>Kubernetes</code> å°±å¯ä»¥ä¿è¯ç”¨æˆ·æäº¤çš„æ¯ä¸€ä¸ª <code>PVC</code>ï¼Œåªè¦æœ‰åˆé€‚çš„ <code>PV</code> å‡ºç°ï¼Œå®ƒèƒ½å¿«é€Ÿçš„è¿›å…¥ç»‘å®šçŠ¶æ€ã€‚
è€Œæ‰€è°“çš„ç»‘å®šï¼Œå…¶å®å°±æ˜¯å°†è¿™ä¸ª <code>PV</code> å¯¹è±¡çš„åå­—å¡«å……åœ¨äº† <code>PVC</code> å¯¹è±¡çš„ <code>spec.volumeName</code> å­—æ®µä¸Šã€‚æ¥ä¸‹æ¥ <code>Kubernetes</code> åªè¦è·å–åˆ°è¿™ä¸ª <code>PVC</code> å¯¹è±¡ï¼Œå°±ä¸€å®šèƒ½å¤Ÿæ‰¾åˆ°å®ƒæ‰€ç»‘å®šçš„ <code>PV</code>.</p><p><code>PV</code> å¯¹è±¡å¦‚ä½•å˜æˆå®¹å™¨é‡Œçš„ä¸€ä¸ªæŒä¹…åŒ–å­˜å‚¨çš„å‘¢ï¼Ÿ</p><p>æ‰€è°“å®¹å™¨çš„ <code>Volume</code> ï¼Œå…¶å®å°±æ˜¯å°†ä¸€ä¸ªå®¿ä¸»æœºä¸Šçš„ç›®å½•ï¼Œè·Ÿå®¹å™¨é‡Œçš„ç›®å½•è¿›è¡Œç»‘å®šæŒ‚è½½åœ¨ä¸€èµ·çš„ï¼Œ
æ‰€è°“çš„ <code>æŒä¹…åŒ–Volume</code> ï¼ŒæŒ‡çš„å°±æ˜¯è¿™ä¸ªå®¿ä¸»æœºä¸Šçš„ç›®å½•ï¼Œå…·å¤‡<code>æŒä¹…åŒ–</code>,å³å½“ç›®å½•é‡Œé¢çš„å†…å®¹ï¼Œæ—¢ä¸ä¼šå› ä¸ºå®¹å™¨çš„åˆ é™¤è€Œè¢«æ¸…ç†ã€ä¹Ÿä¸ä¼šè·Ÿå½“å‰çš„å®¿ä¸»æœºç»‘å®šï¼Œå½“å®¹å™¨è¿›è¡Œé‡å¯æˆ–è€…åœ¨å…¶ä»–èŠ‚ç‚¹ä¸Šé‡å»ºä¹‹åï¼Œä¾ç„¶èƒ½å¤ŸæŒ‚è½½åˆ°è¿™ä¸ª <code>Volume</code>, è®¿é—®è¿™äº›å†…å®¹ï¼Œ
æ‰€ä»¥ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒæŒä¹…åŒ–çš„ <code>Volume</code> çš„å®ç°ï¼Œå¾€å¾€ä¾èµ–ä¸€ä¸ªè¿œç¨‹å­˜å‚¨æœåŠ¡ï¼Œæ¯”å¦‚è¿œç¨‹æ–‡ä»¶å­˜å‚¨ï¼ˆ<code>NFS</code>ã€<code>GlusterFS</code>ï¼‰ï¼Œè¿œç¨‹å—å­˜å‚¨ï¼ˆå…¬æœ‰äº‘çš„è¿œç¨‹ç£ç›˜ï¼‰ã€‚</p><p><code>æŒä¹…åŒ–</code>å®¿ä¸»æœºç›®å½•çš„è¿‡ç¨‹ï¼Œè¿™ä¸ªå½¢è±¡çš„æˆä¸º <code>ä¸¤é˜¶æ®µå¤„ç†</code></p><p>å½“ä¸€ä¸ª <code>POD</code> è°ƒåº¦åˆ°ä¸€ä¸ªèŠ‚ç‚¹ä¸Šå, <code>Kubelet</code> å°±è¦ä¸ºè¿™ä¸ª <code>POD</code> åˆ›å»ºä¸€ä¸ª <code>Volume</code> ç›®å½•, é»˜è®¤æƒ…å†µä¸‹ <code>Kubelet</code> ä¸º <code>Volume</code> åˆ›å»ºçš„ç›®å½•å¦‚ä¸‹æ‰€ç¤ºï¼ˆåœ¨å®¿ä¸»æœºä¸Šï¼‰</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>/var/lib/kubelet/pods/&lt;Podçš„ID&gt;/volumes/kubernetes.io~&lt;Volumeç±»å‹&gt;/&lt;Volumeåå­—&gt;
</span></span></code></pre></div><p>æ¥ä¸‹æ¥, <code>Kubelet</code> è¦åšçš„æ“ä½œå–å†³äº <code>Volume</code> ç±»å‹.
å¦‚æœ <code>Volume</code> ç±»å‹æ˜¯è¿œç¨‹å—å­˜å‚¨ï¼Œæ¯”å¦‚ <code>Google CLoud</code> çš„ <code>Persistent Disk</code>, é‚£ä¹ˆ <code>Kubelet</code> å°±éœ€è¦å…ˆè°ƒç”¨ <code>Google Cloud</code> çš„ <code>API</code>, å°†å®ƒæ‰€æä¾›çš„ <code>Persistent Disk</code> æŒ‚è½½åˆ° <code>Pod</code> æ‰€åœ¨çš„å®¿ä¸»æœºä¸Šã€‚
ç›¸å½“äºæ‰§è¡Œäº†</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>gcloud compute instances attach-disk &lt;è™šæ‹Ÿæœºåå­—&gt; --disk &lt;è¿œç¨‹ç£ç›˜åå­—&gt;
</span></span></code></pre></div><p>ä¸ºè™šæ‹ŸæœºæŒ‚è½½è¿œç¨‹ç£ç›˜çš„æ“ä½œï¼Œå¯¹åº”çš„æ­£æ˜¯ <code>ä¸¤é˜¶æ®µå¤„ç†</code> çš„ç¬¬ä¸€æ®µã€‚å³åœ¨ <code>Kubernetes</code> ä¸­çš„ <code>Attach</code> é˜¶æ®µã€‚</p><p><code>Attach</code> é˜¶æ®µå,è¦èƒ½å¤Ÿä½¿ç”¨è¿™ä¸ªè¿œç¨‹ç£ç›˜, <code>Kubelet</code> éœ€è¦è¿›è¡Œç¬¬äºŒä¸ªæ“ä½œ: å³ä½¿ä¼šè¿™ä¸ªç£ç›˜è®¾å¤‡, ç„¶åå°†å®ƒæŒ‚è½½åˆ°å®¿ä¸»æœºçŸ¥é“çš„æŒ‚è½½ç‚¹ä¸Šã€‚ è¿™ä¸€æ­¥ç›¸å½“äºæ‰§è¡Œ:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># é€šè¿‡lsblkå‘½ä»¤è·å–ç£ç›˜è®¾å¤‡ID</span>
</span></span><span style=display:flex><span>sudo lsblk
</span></span><span style=display:flex><span><span style=color:#75715e># æ ¼å¼åŒ–æˆext4æ ¼å¼</span>
</span></span><span style=display:flex><span>sudo mkfs.ext4 -m <span style=color:#ae81ff>0</span> -F -E lazy_itable_init<span style=color:#f92672>=</span>0,lazy_journal_init<span style=color:#f92672>=</span>0,discard /dev/&lt;ç£ç›˜è®¾å¤‡ID&gt;
</span></span><span style=display:flex><span><span style=color:#75715e># æŒ‚è½½åˆ°æŒ‚è½½ç‚¹</span>
</span></span><span style=display:flex><span>sudo mkdir -p /var/lib/kubelet/pods/&lt;Podçš„ID&gt;/volumes/kubernetes.io~&lt;Volumeç±»å‹&gt;/&lt;Volumeåå­—&gt;
</span></span></code></pre></div><p>è¿™ä¸ªå°†ç£ç›˜è®¾å¤‡æ ¼å¼åŒ–å¹¶æŒ‚è½½åˆ° <code>Volume</code> å®¿ä¸»æœºç›®å½•çš„æ“ä½œ,å¯¹åº”çš„æ­£æ˜¯ &ldquo;ä¸¤é˜¶æ®µå¤„ç†&rdquo; çš„ç¬¬äºŒæ®µ: <code>Mount</code></p><p><code>Kubernetes</code> å¦‚ä½•å®šä¹‰å’ŒåŒºåˆ†è¿™ä¸¤ä¸ªé˜¶æ®µçš„ï¼Ÿ
åœ¨å…·ä½“çš„ <code>Volume</code> æ’ä»¶çš„å®ç°æ¥å£ä¸Š, <code>Kubernetes</code> åˆ†åˆ«ç»™è¿™ä¸¤ä¸ªé˜¶æ®µæä¾›äº†ä¸¤ç§ä¸åŒçš„å‚æ•°åˆ—è¡¨:</p><ul><li>ç¬¬ä¸€é˜¶æ®µ <code>Attach</code>, <code>Kubernetes</code> æä¾›çš„å¯ç”¨å‚æ•°æ˜¯ <code>nodeName</code>, å³å®¿ä¸»æœºçš„åå­—</li><li>ç¬¬äºŒé˜¶æ®µ <code>Mount</code>, <code>Kubernetes</code> æä¾›çš„å¯ç”¨å‚æ•°æ˜¯ <code>dir</code>, å³ <code>Volume</code> çš„å®¿ä¸»æœºç›®å½•</li></ul><p>åœ¨ç»è¿‡ &ldquo;ä¸¤é˜¶æ®µå¤„ç†&rdquo;, æˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ª <code>æŒä¹…åŒ–</code> çš„ <code>Volume</code> å®¿ä¸»æœºç›®å½•, ç„¶å, <code>Kubelet</code> åªè¦æŠŠè¿™ä¸ª <code>Volume</code> ç›®å½•é€šè¿‡ <code>CRI</code> é‡Œçš„ <code>Mounts</code> å‚æ•°,ä¼ é€’ç»™ <code>Docker</code>, ç„¶åå°±å¯ä»¥ä¸º <code>POD</code> é‡Œçš„å®¹å™¨æŒ‚è½½è¿™ä¸ª &ldquo;æŒä¹…åŒ–&rdquo; çš„ <code>Volume</code>ã€‚</p><p>å¦å¤–è¿˜æœ‰ä¸€ä¸ªæ ¸å¿ƒçš„æ¦‚å¿µ <code>StorageClass</code>, <code>Kubernetes</code> ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€å¥—å¯ä»¥è‡ªåŠ¨åˆ›å»º <code>PV</code> çš„æœºåˆ¶, å³ <code>Dynamic Provisioning</code>, å‰é¢äººå·¥ç®¡ç†çš„ <code>PV</code> æ–¹å¼å«åš <code>Static Provisioning</code>ã€‚</p><p><code>Dynamic Provisioning</code> æœºåˆ¶å·¥ä½œçš„æ ¸å¿ƒ, åœ¨äºä¸€ä¸ªåå« <code>StorageClass</code> çš„APIå¯¹è±¡ã€‚è€Œè¿™ä¸ªå¯¹è±¡çš„ä½œç”¨ï¼Œå°±æ˜¯åˆ›å»º PV çš„æ¨¡æ¿ã€‚<code>StorageClass</code>å¯¹è±¡ä¼šå®šä¹‰å¦‚ä¸‹ä¸¤ä¸ªéƒ¨åˆ†å†…å®¹:</p><ul><li>ç¬¬ä¸€, <code>PV</code> çš„å±æ€§ã€‚æ¯”å¦‚ å­˜å‚¨ç±»å‹ã€<code>Volume</code> å¤§å°ç­‰</li><li>ç¬¬äºŒ, åˆ›å»ºè¿™ç§ <code>PV</code> éœ€è¦ç”¨åˆ°çš„å­˜å‚¨æ’ä»¶ã€‚æ¯”å¦‚ <code>Ceph</code> ç­‰
æœ‰è¿™ä¸¤ä¸ªä¿¡æ¯å, <code>Kubernetes</code> å°±å¯ä»¥æ ¹æ®ç”¨æˆ·æäº¤çš„ <code>PVC</code>,æ‰¾åˆ°ä¸€ä¸ªå¯¹åº”çš„ <code>StorageClass</code>ï¼Œç„¶å <code>Kubernetes</code> å°±å¥½è°ƒç”¨è¯¥ <code>StorageClass</code> å£°æ˜çš„å­˜å‚¨æ’ä»¶, åˆ›å»ºå‡ºéœ€è¦çš„ <code>PV</code>ã€‚</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e>#åœ¨è¿™ä¸ª YAML æ–‡ä»¶é‡Œï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªåå« block-service çš„ StorageClassã€‚</span>
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>storage.k8s.io/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>StorageClass</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>block-service</span>
</span></span><span style=display:flex><span><span style=color:#f92672>provisioner</span>: <span style=color:#ae81ff>kubernetes.io/gce-pd</span> <span style=color:#75715e># GCE PD å­˜å‚¨æ’ä»¶çš„åå­—</span>
</span></span><span style=display:flex><span><span style=color:#f92672>parameters</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>type</span>: <span style=color:#ae81ff>pd-ssd</span> <span style=color:#75715e># SSDæ ¼å¼çš„GCEè¿œç¨‹ç£ç›˜</span>
</span></span></code></pre></div><h1 id=kubernetes-pv-å’Œ-pvc-ä½“ç³»æ˜¯ä¸æ˜¯å¤šæ­¤ä¸€æ ·>Kubernetes PV å’Œ PVC ä½“ç³»æ˜¯ä¸æ˜¯å¤šæ­¤ä¸€æ ·</h1><p>Kubernetes æ”¯æŒå¤šç§çš„æŒä¹…åŒ– <a href=https://kubernetes.io/docs/concepts/storage/persistent-volumes/#types-of-persistent-volumes>Kuberneteså†…ç½®çš„æŒä¹…åŒ–æ•°æ®å·å®ç°</a></p><p>åœ¨é€šè¿‡ <code>PV</code> å’Œ <code>PVC</code>, ä»¥åŠ <code>StorageClass</code> è¿™å¥—å­˜å‚¨ä½“ç³», ä¸ºåæ¥æ·»åŠ æŒä¹…åŒ–å­˜å‚¨æ–¹æ¡ˆ,å¯¹å·²æœ‰çš„ <code>Kubernetes</code> çš„å½±å“,å‡ ä¹å¯ä»¥å¿½ç•¥ä¸åŠã€‚ä½œä½ç”¨æˆ·, <code>POD</code> çš„ <code>YAML</code> å’Œ <code>PVC</code> çš„ <code>YAML</code> å¹¶æ²¡æœ‰ä»»ä½•ç‰¹æ®Šçš„æ”¹å˜.</p><h1 id=æ€»ç»“>æ€»ç»“</h1><p><img src=/%E5%9B%9E%E6%9C%9BK8S/pvc-pv-storageclass-check.png alt=PVC-PVè®¾è®¡></p><ul><li><code>PVC</code> æè¿° <code>POD</code> æƒ³è¦ä½¿ç”¨çš„æŒä¹…åŒ–å­˜å‚¨çš„å±æ€§ï¼Œæ¯”å¦‚å­˜å‚¨çš„å¤§å°ã€è¯»å†™æƒé™ã€‚</li><li><code>PV</code> æè¿°çš„ ä¸€ä¸ªå…·ä½“çš„ <code>Volume</code> çš„å±æ€§ã€æ¯”å¦‚ <code>Volume</code> çš„ç±»å‹ã€æŒ‚è½½ç›®å½•ã€è¿œç¨‹å­˜å‚¨æœåŠ¡å™¨åœ°å€</li><li><code>StorageClass</code> ä½œç”¨ï¼Œå……å½“ <code>PV</code> çš„æ¨¡æ¿ï¼Œåªè¦åŒå±äºä¸€ä¸ª <code>StorageClass</code> çš„ <code>PV</code> å’Œ <code>PVC</code>ï¼Œæ‰å¯ä»¥ç»‘å®šåœ¨ä¸€èµ·ã€‚</li></ul><p><img src=/%E5%9B%9E%E6%9C%9BK8S/pvc-pv.png alt=KubernetesæŒä¹…åŒ–å­˜å‚¨çš„åŸç†>
<img src=/%E5%9B%9E%E6%9C%9BK8S/CSI.png alt=KubernetesæŒä¹…åŒ–å­˜å‚¨çš„é€šè¿‡CSIæ’ä»¶æ“ä½œåŸç†></p><ul><li><code>Driver Registrar</code> ç»„ä»¶è´Ÿè´£å°†æ’ä»¶æ³¨å†Œåˆ° <code>kubelet</code> é˜¶æ®µï¼Œè¯·æ±‚<code>CSI</code>æ’ä»¶çš„ <code>IdentityæœåŠ¡</code> è·å–æ’ä»¶ä¿¡æ¯</li><li><code>External Provisioner</code> ç»„ä»¶ <code>Provision é˜¶æ®µ</code>, <code>External Provisioner</code> ç›‘å¬ï¼ˆ<code>Watch</code>ï¼‰äº† <code>APIServer</code> é‡Œçš„ <code>PVCå¯¹è±¡</code>ã€‚å½“ä¸€ä¸ª <code>PVC</code> è¢«åˆ›å»ºæ—¶ï¼Œå®ƒå°±ä¼šè°ƒç”¨ <code>CSI Controller</code> çš„ <code>CreateVolume</code> æ–¹æ³•ï¼Œä¸ºä½ åˆ›å»ºå¯¹åº” <code>PV</code></li><li><code>External Attacher</code> ç»„ä»¶è´Ÿè´£æ­£æ˜¯ &ldquo;<code>Attach é˜¶æ®µ</code>&rdquo;, å®ƒç›‘å¬äº† <code>APIServer</code> é‡Œçš„ <code>VolumeAttachment å¯¹è±¡</code>çš„å˜åŒ–, <code>VolumeAttachment å¯¹è±¡</code>æ˜¯ <code>Kubernetes</code> ç¡®è®¤ä¸€ä¸ª <code>Volume</code> å¯ä»¥è¿›å…¥ <code>Attach é˜¶æ®µ</code> çš„é‡è¦æ ‡å¿—</li></ul></div></article><div class=blog-post-comments><div id=disqus_thread><script type=text/javascript>(function(){var t,e=document.createElement("script");e.type="text/javascript",e.async=!0,t="pinkhello",e.src="//"+t+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com/ class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></div><div id=footer-post-container><div id=footer-post><div id=nav-footer style=display:none><ul><li><a href=/>Home</a></li><li><a href=/posts>Posts</a></li><li><a href=/categories>Category</a></li><li><a href=/tags>Tag</a></li><li><a href=/index.xml>Rss</a></li><li><a href=/jobs>Job</a></li></ul></div><div id=share-footer style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fpinkhello.cc%2fposts%2f22-%25E5%259B%259E%25E6%259C%259Bk8s-%25E6%258C%2581%25E4%25B9%2585%25E5%258C%2596%25E5%25AD%2598%25E5%2582%25A8%2f" aria-label=Facebook><i class="fab fa-facebook fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2fpinkhello.cc%2fposts%2f22-%25E5%259B%259E%25E6%259C%259Bk8s-%25E6%258C%2581%25E4%25B9%2585%25E5%258C%2596%25E5%25AD%2598%25E5%2582%25A8%2f&text=%e5%9b%9e%e6%9c%9bK8S%20%e6%8c%81%e4%b9%85%e5%8c%96%e5%ad%98%e5%82%a8" aria-label=Twitter><i class="fab fa-twitter fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fpinkhello.cc%2fposts%2f22-%25E5%259B%259E%25E6%259C%259Bk8s-%25E6%258C%2581%25E4%25B9%2585%25E5%258C%2596%25E5%25AD%2598%25E5%2582%25A8%2f&title=%e5%9b%9e%e6%9c%9bK8S%20%e6%8c%81%e4%b9%85%e5%8c%96%e5%ad%98%e5%82%a8" aria-label=Linkedin><i class="fab fa-linkedin fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fpinkhello.cc%2fposts%2f22-%25E5%259B%259E%25E6%259C%259Bk8s-%25E6%258C%2581%25E4%25B9%2585%25E5%258C%2596%25E5%25AD%2598%25E5%2582%25A8%2f&is_video=false&description=%e5%9b%9e%e6%9c%9bK8S%20%e6%8c%81%e4%b9%85%e5%8c%96%e5%ad%98%e5%82%a8" aria-label=Pinterest><i class="fab fa-pinterest fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=%e5%9b%9e%e6%9c%9bK8S%20%e6%8c%81%e4%b9%85%e5%8c%96%e5%ad%98%e5%82%a8&body=Check out this article: https%3a%2f%2fpinkhello.cc%2fposts%2f22-%25E5%259B%259E%25E6%259C%259Bk8s-%25E6%258C%2581%25E4%25B9%2585%25E5%258C%2596%25E5%25AD%2598%25E5%2582%25A8%2f" aria-label=Email><i class="fas fa-envelope fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fpinkhello.cc%2fposts%2f22-%25E5%259B%259E%25E6%259C%259Bk8s-%25E6%258C%2581%25E4%25B9%2585%25E5%258C%2596%25E5%25AD%2598%25E5%2582%25A8%2f&title=%e5%9b%9e%e6%9c%9bK8S%20%e6%8c%81%e4%b9%85%e5%8c%96%e5%ad%98%e5%82%a8" aria-label=Pocket><i class="fab fa-get-pocket fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fpinkhello.cc%2fposts%2f22-%25E5%259B%259E%25E6%259C%259Bk8s-%25E6%258C%2581%25E4%25B9%2585%25E5%258C%2596%25E5%25AD%2598%25E5%2582%25A8%2f&title=%e5%9b%9e%e6%9c%9bK8S%20%e6%8c%81%e4%b9%85%e5%8c%96%e5%ad%98%e5%82%a8" aria-label=reddit><i class="fab fa-reddit fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fpinkhello.cc%2fposts%2f22-%25E5%259B%259E%25E6%259C%259Bk8s-%25E6%258C%2581%25E4%25B9%2585%25E5%258C%2596%25E5%25AD%2598%25E5%2582%25A8%2f&name=%e5%9b%9e%e6%9c%9bK8S%20%e6%8c%81%e4%b9%85%e5%8c%96%e5%ad%98%e5%82%a8&description=PV%e3%80%81PVC%e3%80%81StorageClass%20%e8%af%b4%e7%9a%84%e5%95%a5%ef%bc%9f%20PV%3a%20%e6%8c%81%e4%b9%85%e5%8c%96%e5%ad%98%e5%82%a8%e6%95%b0%e6%8d%ae%e5%8d%b7%ef%bc%8c%e8%bf%99%e4%b8%aa%20API%20%e4%b8%bb%e8%a6%81%e5%ae%9a%e4%b9%89%e7%9a%84%e6%98%af%e4%b8%80%e4%b8%aa%e6%8c%81%e4%b9%85%e5%8c%96%e5%ad%98%e5%82%a8%e5%9c%a8%e5%ae%bf%e4%b8%bb%e6%9c%ba%e4%b8%8a%e7%9a%84%e4%b8%80%e4%b8%aa%e7%9b%ae%e5%bd%95%e3%80%82%e4%b8%80%e8%88%ac%e7%94%b1%e8%bf%90%e7%bb%b4%e4%ba%ba%e5%91%98%e8%bf%9b%e8%a1%8c%e5%ae%9a%e4%b9%89%ef%bc%8c%e6%af%94%e5%a6%82%e5%ae%9a%e4%b9%89%e4%b8%80%e4%b8%aa%20NFS%20%e7%b1%bb%e5%9e%8b%e7%9a%84%20PV%0aapiVersion%3a%20v1%20kind%3a%20PersistentVolume%20metadata%3a%20name%3a%20nfs%20spec%3a%20storageClassName%3a%20manual%20capacity%3a%20storage%3a%201Gi%20accessModes%3a%20-%20ReadWriteMany%20nfs%3a%20server%3a%2010.244.1.5%20path%3a%20%26%2334%3b%2f%26%2334%3b%20PVC%3a%20POD%20%e6%89%80%e5%b8%8c%e6%9c%9b%e4%bd%bf%e7%94%a8%e7%9a%84%e6%8c%81%e4%b9%85%e5%8c%96%e5%ad%98%e5%82%a8%e7%9a%84%e5%b1%9e%e6%80%a7.%20%e6%af%94%e5%a6%82%20Volume%20%e7%9a%84%e5%ad%98%e5%82%a8%e5%a4%a7%e5%b0%8f%e3%80%81%e5%8f%af%e8%af%bb%e5%86%99%e6%9d%83%e9%99%90%e7%ad%89.%20PVC%20%e4%b8%80%e8%88%ac%e7%94%b1%e5%bc%80%e5%8f%91%e4%ba%ba%e5%91%98%e5%88%9b%e5%bb%ba%e3%80%81%e6%88%96%e8%80%85%e7%94%b1%20PVC%e6%a8%a1%e6%9d%bf%e7%9a%84%e6%96%b9%e5%bc%8f%e6%88%90%e4%b8%baStatefulSet%e7%9a%84%e4%b8%80%e9%83%a8%e5%88%86%ef%bc%8c%e7%94%b1StatefulSet%e6%8e%a7%e5%88%b6%e5%99%a8%e8%b4%9f%e8%b4%a3%e5%88%9b%e5%bb%ba%e5%b8%a6%e7%bc%96%e5%8f%b7%e7%9a%84PVC.%0a%23%20%e5%88%9b%e5%bb%ba%e4%b8%80%e4%b8%aa%201%20GB%20%e5%a4%a7%e5%b0%8f%e7%9a%84PVC%20---%20apiVersion%3a%20v1%20kind%3a%20PersistentVolumeClaim%20metadata%3a%20name%3a%20nfs%20spec%3a%20accessModes%3a%20-%20ReadWriteMany%20storageClassName%3a%20manual%20resources%3a%20requests%3a%20storage%3a%201Gi%20...%20%e7%94%a8%e6%88%b7%e5%88%9b%e5%bb%ba%e7%9a%84PVC%e8%a6%81%e7%9c%9f%e6%ad%a3%e7%9a%84%e8%a2%ab%e5%ae%b9%e5%99%a8%e4%bd%bf%e7%94%a8%e7%9a%84%e5%8c%96%ef%bc%8c%e9%9c%80%e8%a6%81%e4%ba%8e%e5%bf%83%e5%92%8c%e6%9f%90%e4%b8%aa%e7%ac%a6%e5%90%88%e6%9d%a1%e4%bb%b6%e7%9a%84PV%e8%bf%9b%e8%a1%8c%e7%bb%91%e5%ae%9a%ef%bc%9a%0a%e7%ac%ac%e4%b8%80%e4%b8%aa%e6%9d%a1%e4%bb%b6%ef%bc%8cPV%20%e5%92%8c%20PVC%20%e7%9a%84%20spec%20%e5%ad%97%e6%ae%b5%e3%80%82%e4%be%8b%e5%a6%82%3a%20PV%20%e7%9a%84%e5%ad%98%e5%82%a8%28storage%29%e5%a4%a7%e5%b0%8f%e5%b0%b1%e5%bf%85%e9%a1%bb%e6%bb%a1%e8%b6%b3%20PVC%20%e7%9a%84%e8%a6%81%e6%b1%82%20%e7%ac%ac%e4%ba%8c%e4%b8%aa%e6%9d%a1%e4%bb%b6%ef%bc%8cPV%20%e5%92%8c%20PVC%20%e7%9a%84%20storageClassName%20%e5%ad%97%e6%ae%b5%e5%90%8d%e7%a7%b0%e5%bf%85%e9%a1%bb%e4%b8%80%e6%a0%b7%e3%80%82%20%e4%b8%8b%e9%9d%a2%e6%98%af%e5%8e%bb%e4%bd%bf%e7%94%a8%e8%bf%99%e4%b8%aaPVC" aria-label=Tumblr><i class="fab fa-tumblr fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fpinkhello.cc%2fposts%2f22-%25E5%259B%259E%25E6%259C%259Bk8s-%25E6%258C%2581%25E4%25B9%2585%25E5%258C%2596%25E5%25AD%2598%25E5%2582%25A8%2f&t=%e5%9b%9e%e6%9c%9bK8S%20%e6%8c%81%e4%b9%85%e5%8c%96%e5%ad%98%e5%82%a8" aria-label="Hacker News"><i class="fab fa-hacker-news fa-lg" aria-hidden=true></i></a></li></ul></div><div id=actions-footer><a id=menu-toggle class=icon href=# onclick='return $("#nav-footer").toggle(),!1' aria-label=Menu><i class="fas fa-bars fa-lg" aria-hidden=true></i> Menu</a>
<a id=share-toggle class=icon href=# onclick='return $("#share-footer").toggle(),!1' aria-label=Share><i class="fas fa-share-alt fa-lg" aria-hidden=true></i> share</a>
<a id=top style=display:none class=icon href=# onclick='$("html, body").animate({scrollTop:0},"fast")' aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg" aria-hidden=true></i> Top</a></div></div></div><footer id=footer><div class=footer-left>Copyright &copy; 2022 pinkhello</div><div class=footer-right><nav><ul><li><a href=/>Home</a></li><li><a href=/posts>Posts</a></li><li><a href=/categories>Category</a></li><li><a href=/tags>Tag</a></li><li><a href=/index.xml>Rss</a></li><li><a href=/jobs>Job</a></li></ul></nav></div></footer></div></body><link rel=stylesheet href=/lib/font-awesome/css/all.min.css><script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>
<script src=/js/code-copy.js></script>
<script>MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]]},svg:{fontCache:"global"}}</script><script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script></html>