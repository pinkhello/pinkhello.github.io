<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>golang on pinkhello</title><link>https://pinkhello.cc/tags/golang/</link><description>Recent content in golang on pinkhello</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><copyright>pinkhello</copyright><lastBuildDate>Wed, 30 Mar 2022 00:07:36 +0800</lastBuildDate><atom:link href="https://pinkhello.cc/tags/golang/index.xml" rel="self" type="application/rss+xml"/><item><title>randåº“é”ç«äº‰ä¼˜åŒ–</title><link>https://pinkhello.cc/posts/go-rand/</link><pubDate>Wed, 30 Mar 2022 00:07:36 +0800</pubDate><guid>https://pinkhello.cc/posts/go-rand/</guid><description>å‰è¨€ ä»Šå¤©ï¼Œåœ¨å†™éšæœºæ•°çš„ç”Ÿæˆçš„æ—¶å€™ï¼Œå¥½å¥‡ rand åº“åœ¨ golang çš„å®ç°ï¼Œå°±ç¿»è¿›å»çœ‹ä¸€çœ¼çš„ã€‚rand.go#293 ä»£ç 
var globalRand = New(&amp;amp;lockedSource{src: NewSource(1).(*rngSource)}) ç«Ÿç„¶æ˜¯å…¨å±€å…±äº«çš„ä¸€ä¸ª å…¨å±€çš„ globalRand çš„ å¯¹è±¡ã€‚å¯ä»¥çŒœæƒ³åˆ°åœ¨å¤š goroutine ä¸‹ï¼Œæ€§èƒ½åº”è¯¥æ¯”è¾ƒå·®ï¼Œå­˜åœ¨ç«äº‰çš„æƒ…å†µã€‚
éªŒè¯ éšæœºéªŒè¯ä¸€ä¸‹, éªŒè¯ä¸€ä¸‹
ç¬¬ä¸€ç§æƒ…å†µï¼Œå°±æ˜¯æ™®é€šçš„å¹¶å‘æƒ…å†µä¸‹ä½¿ç”¨é»˜è®¤çš„ rand åº“ã€‚ä½¿å…¶å…±ç”¨ä¸€ä¸ª globalRand å¯¹è±¡ã€‚ func BenchmarkGlobalRand_test(b *testing.B) { b.RunParallel(func(p *testing.PB) { for p.Next() { rand.Intn(200) } }) } è¾“å‡º
BenchmarkGlobalRand_test BenchmarkGlobalRand_test-8 16704190 72.53 ns/op 0 B/op 0 allocs/op BenchmarkGlobalRand_test-8 17005326 68.90 ns/op 0 B/op 0 allocs/op BenchmarkGlobalRand_test-8 17651659 66.54 ns/op 0 B/op 0 allocs/op BenchmarkGlobalRand_test-8 17879901 68.</description></item><item><title>Golang for Range æ¢ç©¶</title><link>https://pinkhello.cc/posts/golang-for-range-%E6%8E%A2%E7%A9%B6/</link><pubDate>Sun, 27 Mar 2022 14:20:28 +0800</pubDate><guid>https://pinkhello.cc/posts/golang-for-range-%E6%8E%A2%E7%A9%B6/</guid><description>å‰è¨€ ä»Šå¤©åœ¨ç”¨ Golang å†™ TCP é•¿é“¾æ¥çš„æ—¶å€™ï¼Œåœ¨åšæµ‹è¯•çš„æ—¶å€™ for range æœ‰åœ¨ç»“æ„åŒ…çš„æ—¶å€™æœ‰æ€§èƒ½é—®é¢˜ã€‚æ‰€ä»¥å°±ç»†åŒ–æ¢ç©¶äº†ä¸€ä¸‹ã€‚
å¤ç° å‡è®¾æœ‰ä¸€ä¸ª Packet ç±»å‹([1024]byte)çš„æ•°æ®åŒ…,æˆ‘ä»¬ä»ç½‘ç»œä¸­è·å–åˆ°ä¸€ä¸ª [1024]Packet çš„æ•°æ®åŒ…ï¼Œæˆ‘ä»¬è¿›è¡Œéå†
type Packet [1024]byte func BenchmarkForStruct_test(b *testing.B) { var items [1024]Packet var result Packet for i := 0; i &amp;lt; b.N; i++ { for k := 0; k &amp;lt; len(items); k++ { result = items[k] } } _ = result } func BenchmarkRangeStruct_test(b *testing.B) { var items [1024]Packet var result Packet for i := 0; i &amp;lt; b.</description></item><item><title>Golangçš„æ± åŒ–è®¾è®¡</title><link>https://pinkhello.cc/posts/43-golang%E7%9A%84%E6%B1%A0%E5%8C%96%E8%AE%BE%E8%AE%A1/</link><pubDate>Wed, 02 Feb 2022 02:52:28 +0800</pubDate><guid>https://pinkhello.cc/posts/43-golang%E7%9A%84%E6%B1%A0%E5%8C%96%E8%AE%BE%E8%AE%A1/</guid><description>Why Poolï¼Ÿ å…ˆåŸ‹å‘: Go æœ‰æ²¡æœ‰æ± åŒ–çš„å¿…è¦? ä¸ºä»€ä¹ˆè¦æ± åŒ–? Go è‡ªä»å‡ºç”Ÿä»¥æ¥éƒ½è¢«æˆ‘ä»¬å† ä»¥&amp;quot;é«˜å¹¶å‘&amp;quot;çš„Tag, å›å¤´ç»†æƒ³å’Œæ·±ç©¶ä¸€ä¸‹ï¼Œä½ ä¼šå‘ç°å…¶å®éƒ½æ˜¯ç”± goroutine å®ç°çš„ , æˆ‘ä»¬éƒ½çŸ¥é“ ä¸ Thread ç›¸æ¯”ï¼Œ åˆ›å»º Goroutine çš„ä»£ä»·éå¸¸å°ã€‚ä»ç¨‹åºè¡¨ç°ä¸Šï¼Œä¹Ÿåƒæäº†Thread, æ¯ä¸ª Program è‡³å°‘åŒ…å«ä¸€ä¸ª Goroutine(è‡³å°‘ä¸€ä¸ª**Main Goroutine**) æ‰€æœ‰çš„å…¶ä»– Goroutines éƒ½ä¾é™„äº Main Goroutineï¼ˆå¦‚æœ Main Goroutine Terminated, å…¶ä»– Goroutines ä¹Ÿä¼š Terminatedï¼‰, Goroutine æ€»æ˜¯å·¥ä½œåœ¨åå°ã€‚
å¤šçº¿ç¨‹``å¤šè¿›ç¨‹æ˜¯ä¸ºäº†æé«˜ç³»ç»Ÿçš„å¹¶å‘èƒ½åŠ›ï¼Œå½“å‰ç³»ç»Ÿä¸‹ï¼Œè¿™è¾¹å°±éœ€è¦ç³»ç»Ÿè°ƒåº¦ï¼Œä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ‹†åˆ†ä¸º &amp;quot;ç”¨æˆ·æ€&amp;quot;çº¿ç¨‹ å’Œ &amp;quot;å†…æ ¸æ€&amp;quot;çº¿ç¨‹ï¼Œè¿™ä¸¤è€…éœ€è¦è¿›è¡Œç»‘å®šï¼Œæˆ‘ä»¬ä¸€èˆ¬ç§° å†…æ ¸æ€çº¿ç¨‹ ä¸ºçº¿ç¨‹ï¼Œç”¨æˆ·æ€çº¿ç¨‹ä¸ºåç¨‹
ä»ä¸Šé¢å¯ä»¥çœ‹å‡º åç¨‹ å’Œ çº¿ç¨‹ æœ‰æ˜ å°„å…³ç³»ï¼Œè¿™æ ·å°±æ¥äº† M:N å…³ç³»(ä¸ºä»€ä¹ˆä¸æ˜¯ 1:1, N:1 ? )
Goroutine ä¼˜ç‚¹:
ç›¸æ¯” Thread ä»£ä»·æ›´å° Goroutine å…¶åœ¨ stack çš„å¤§å°å¯ä»¥æ ¹æ®ç¨‹åºè¦æ±‚è¿›è¡Œå˜åŒ–ï¼Œä½†æ˜¯ Thread æ˜¯å›ºå®šçš„ Goroutine ä½¿ç”¨ Channel è¿›è¡Œé€šä¿¡ï¼ŒChannel ç”¨äº Goroutines è®¿é—®å…±äº«å†…å­˜çš„æ—¶å€™é˜²æ­¢ç«äº‰çš„ã€‚ ä»ç¨‹åºä¸Šä¸€ä¸ªçº¿ç¨‹å¯èƒ½æ‹¥æœ‰è®¸å¤šçš„ Goroutines å…³è”ï¼Œå¦‚æœè¿™äº›å…³è”çš„ æœ‰ä¸€ä¸ª Goroutine å»é˜»å¡äº†çº¿ç¨‹ï¼Œé‚£ä¹ˆå‰©ä½™çš„ Goroutine å°†åˆ†é…ç»™å…¶ä»–çš„ OS Threadï¼Œä¸”è¿™ç§åˆ‡æ¢æ“ä½œæ˜¯å¯¹å¼€å‘è€…å±è”½çš„ã€‚ Goroutine è°ƒåº¦å™¨ å›å¤´çœ‹å°† Goroutine å’Œ åç¨‹ æœ‰åŒºåˆ«çš„ã€‚è°ƒåº¦</description></item><item><title>æ¢ç§˜è´Ÿè½½å‡è¡¡</title><link>https://pinkhello.cc/posts/36-%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%9A%84%E6%80%9D%E8%80%83/</link><pubDate>Fri, 01 Oct 2021 10:04:00 +0800</pubDate><guid>https://pinkhello.cc/posts/36-%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%9A%84%E6%80%9D%E8%80%83/</guid><description>å‰è¨€ ä»Šå¤©æ˜¯å›½åº†çš„ç¬¬3å¤©ï¼Œåœ¨æ­¤æ­ç¥å°å“¥å“¥å’Œå°å§å§ä»¬â›±ï¸èŠ‚æ—¥å¿«ä¹ï¼ å¾®ä¿¡æœ‹å‹åœˆğŸ€„ï¸å…¨éƒ¨æ˜¯ æ—…é€”INGã€‚
æˆ‘çš„å›½åº†ï¼š
ç¬¬ä¸€å¤©: å¸¦ğŸª† ç¬¬äºŒå¤©: è¢«å¯ä¸œå‘äº†ä¸€å› ç¬¬ä¸‰å¤©: ğŸˆšï¸å­©ä¸€èº«è½» &amp;hellip;&amp;hellip; å¯¹äºæˆ‘è¿™ç§ç¤¾äº¤å°´å°¬è€…ï¼Œâ›±ï¸åº¦å‡æœ€å¥½çš„æ–¹å¼è¿˜æ˜¯å­¦ä¹ ã€‚
ä»Šæ—¥å¸¦æ¥äº† è‡ªå·±å¯¹äºè´Ÿè½½å‡è¡¡(load balance)çš„å­¦ä¹ ã€‚
åº¦å‡æœ€å¥½çš„æ–¹å¼æ˜¯å­¦ä¹  GRPCåœ¨è´Ÿè½½å‡è¡¡çš„è®¾è®¡: Load-balancing.md
ä¸ºä»€ä¹ˆè¦è´Ÿè½½å‡è¡¡ åœ¨å¦‚ä»Šçš„äº’è”ç½‘é¢†åŸŸï¼Œå¯¹äºæ•°æ®çš„å¤§çˆ†å‘ï¼Œé«˜é¢‘çš„è¯·æ±‚ï¼Œå¯¹äºæä¾›æœåŠ¡çš„ä¼ä¸šæ¥è¯´æ˜¯ä¸å°çš„ITèµ„æºå¼€é”€ã€‚ä¸ºäº†è§£å†³èµ„æºä¸­çš„è´Ÿè½½åˆ†é…ï¼Œå¹¶ä¸”ä½¿å¾—èµ„æºçš„åˆ©ç”¨ç‡è¾¾åˆ°æœ€å¤§ã€‚å‡ºç°äº†è´Ÿè½½å‡è¡¡ï¼Œä¸»è¦ä¸ºäº†è§£å†³ é«˜å¹¶å‘ å’Œ é«˜å¯ç”¨ã€‚
è´Ÿè½½å‡è¡¡çš„å®ç°æ–¹å¼æœ‰ï¼šè½¯ä»¶ å’Œ ç¡¬ä»¶ã€‚è¿™æ¬¡æˆ‘å­¦ä¹ çš„ä¸»æ˜¯è½¯ä»¶æ–¹å¼ã€‚
è´Ÿè½½å‡è¡¡çš„ç®—æ³• è½®è¯¢( Round Robin ) &amp;amp; åŠ æƒè½®è¯¢( Weight Round Robin ) : éšæœº &amp;amp; åŠ æƒéšæœº æœ€å°‘è¿æ¥( Last Connections ) : é€šè¿‡å°†æµé‡å¼•å¯¼åˆ°ç¬¬ä¸€ä¸ªå¯ç”¨æœåŠ¡å™¨ç„¶åå°†è¯¥æœåŠ¡å™¨ç§»åŠ¨åˆ°é˜Ÿåˆ—åº•éƒ¨æ¥è½®æ¢æœåŠ¡å™¨ï¼Œå½“æœåŠ¡å™¨å…·æœ‰ç›¸åŒçš„è§„æ ¼å¹¶ä¸”æ²¡æœ‰å¾ˆå¤šæŒä¹…è¿æ¥æ—¶æœ€æœ‰ç”¨ã€‚ å“ˆå¸Œ( Hash ) eg: ip hash ä¸€è‡´æ€§å“ˆå¸Œ( Consistent Hash ) eg: request_url ä¸€è‡´æ€§å“ˆå¸Œ æœ€å°‘å“åº”æ—¶é—´ : å°†æµé‡å®šå‘åˆ°æ´»åŠ¨è¿æ¥æœ€å°‘ä¸”å¹³å‡å“åº”æ—¶é—´æœ€çŸ­çš„æœåŠ¡å™¨ã€‚ å¸¸ç”¨çš„è´Ÿè½½å‡è¡¡æ‰‹æ®µ Load-balancing.md å·²ç»ä»‹ç»äº†ä»¥ä¸‹å‡ ç§</description></item></channel></rss>